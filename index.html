<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Organization">
<head>
	<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Parallel Universe</title>
        <meta name="description" content="">
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="width=1100">
        <script type="text/javascript" src="//use.typekit.net/pfn0abv.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
        <link href='http://fonts.googleapis.com/css?family=Arimo:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="/galaxy/css/screen.css">
        <script src="/galaxy/js/vendor/modernizr-2.6.2.min.js"></script>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
        <script src="/galaxy/js/plugins.js"></script>
        <script src="/galaxy/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','XXX'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src='//www.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    <!--[if lt IE 9]>
        <script src="js/vendor/html5shiv.js"></script>
    <![endif]-->
     <!--[if lt IE 8]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
</head>
</head>
<body class="fixed-documentation">
	ֿ<header>
    <div class="container">
        <a href="/galaxy" id="logo">Parallel Universe</a>
        <ul id="nav">
            <li class="sub">
                <a>Products</a>
                <ul>
                    <li class="li1"><a href="http://paralleluniverse.co/comsat/">Comsat</a></li>
                    <li class="li2"><a href="http://paralleluniverse.co/quasar/">Quasar</a></li>
                    <li class="li3"><a href="http://paralleluniverse.co/spacebase/">Spacebase</a></li>
                    <li class="li4"><a href="http://paralleluniverse.co/galaxy/">Galaxy</a></li>
                </ul>
            </li>
            <li><a href="http://paralleluniverse.co/support/">Support</a></li>
            <li><a href="http://docs.paralleluniverse.co">Documentation</a></li>
            <li><a href="http://paralleluniverse.co/about/">Company</a></li>
            <li><a href="http://blog.paralleluniverse.co">Blog</a></li>
        </ul>
    </div>
</header>
 

	<section id="main">
		<div class="container">
			<div id="docs-cont" class="clearfix">
				<div class="sidebar">
					<ul id="docs-sidemenu">
<li class="li1">
<a href="#overview">Overview</a><ul><li>
<a href="#news" class="cat-link">News</a><ul>
<li><a href="#january-22-2014">January 22, 2014</a></li>
<li><a href="#august-9-2012">August 9, 2012</a></li>
<li><a href="#august-3-2012">August 3, 2012</a></li>
<li><a href="#july-26-2012">July 26, 2012</a></li>
<li><a href="#july-10-2012">July 10, 2012</a></li>
</ul>
</li></ul>
</li>
<li class="li1">
<a href="#getting-started">Getting Started</a><ul><li><ul>
<li><a href="#system-requirements">System requirements</a></li>
<li><a href="#downloading-galaxy">Downloading Galaxy</a></li>
<li><a href="#building-galaxy">Building Galaxy</a></li>
<li><a href="#using-maven">Using Maven</a></li>
<li>
<a href="#pre-built">Using the pre-built configurations</a><ul>
<li><a href="#peer-configuration" class="toc-h4">Peer configuration</a></li>
<li><a href="#server-configuration" class="toc-h4">Server configuration</a></li>
</ul>
</li>
<li>
<a href="#running-galaxy">Running Galaxy</a><ul>
<li><a href="#running-the-server" class="toc-h4">Running the server</a></li>
<li><a href="#using-the-peers" class="toc-h4">Using the peers</a></li>
</ul>
</li>
</ul></li></ul>
</li>
<li class="li1">
<a href="#user-manual">User Manual</a><ul>
<li>
<a href="#introduction-to-galaxy" class="cat-link">Introduction to Galaxy</a><ul>
<li><a href="#intro-architecture">Galaxy Features and Architecture</a></li>
<li><a href="#galaxy-internals">Galaxy Internals</a></li>
<li><a href="#tips-for-achieving-high-performance-with-galaxy">Tips for Achieving High-Performance with Galaxy</a></li>
</ul>
</li>
<li>
<a href="#api" class="cat-link">Galaxy’s API</a><ul>
<li><a href="#getting-the-grid-instance">Getting the grid instance</a></li>
<li>
<a href="#grid-services">Grid services</a><ul>
<li><a href="#api-store" class="toc-h4">Data Store</a></li>
<li><a href="#api-messenger" class="toc-h4">Messenger</a></li>
<li><a href="#api-cluster" class="toc-h4">Cluster Management</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#config" class="cat-link">Configuring and Monitoring Galaxy</a><ul>
<li><a href="#config-file">The configuration file(s)</a></li>
<li><a href="#config-monitoring">Configuring Galaxy monitoring</a></li>
<li><a href="#config-component-monitor">Monitoring Galaxy’s components</a></li>
<li><a href="#config-logging">Logging</a></li>
<li>
<a href="#galaxys-components">Galaxy’s components</a><ul>
<li><a href="#config-spring" class="toc-h4">A Spring Primer</a></li>
<li><a href="#config-cluster" class="toc-h4">Configuring the Cluster Component</a></li>
<li><a href="#config-cache" class="toc-h4">Configuring and Monitoring the Cache</a></li>
<li><a href="#config-messenger" class="toc-h4">Configuring and Monitoring the Messenger</a></li>
<li><a href="#config-comm" class="toc-h4">Configuring and Monitoring the Comm Component</a></li>
<li><a href="#config-server" class="toc-h4">Configuring, Running and Monitoring the Server</a></li>
<li><a href="#config-misc" class="toc-h4">Miscellaneous Configurations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
				</div>

				<div class="main">
					<div class="doc-text">
						<h1 id="overview">Overview</h1>

<p>Galaxy is a high-performance in-memory data-grid (<span class="caps">IMDG</span>) that can serve as a basis for building distributed&nbsp;applications
that require fine-tuned control over data placement and/or custom distributed&nbsp;data-structures. </p>

<p>What makes Galaxy different from other IMDGs is the way it assigns data items to cluster node. Instead of sharding the&nbsp;data
on one of the keys using a consistent hashing scheme, Galaxy dynamically moves  objects from one node to another as&nbsp;needed
using a cache-coherence protocol similar to that found in CPUs. This makes Galaxy suitable for applications with&nbsp;predictable 
data access patterns, i.e. applications where the data items behave according to some proximity metric, and items that&nbsp;are
“closer” together are more likely to be accessed together than items that are “far”&nbsp;apart.</p>

<p>Galaxy is not a key-value store, though it can be used to build one. It’s meant to be used as a low-level platform&nbsp;for 
building distributed data&nbsp;structures.</p>

<p>Galaxy uses <strong>ZooKeeper</strong> or <strong>JGroups</strong> for cluster management, and <strong>Berkeley<span class="caps">DB</span></strong> or <strong>any <span class="caps">SQL</span> database</strong> for&nbsp;optional 
persistence.</p>

<p class="alert alert-warn"><strong>Note</strong>: Galaxy is currently in <span class="caps">ALPHA</span> and considered experimental. Please submit bug reports and feature requests to the <a href="https://github.com/puniverse/galaxy/issues">issue tracker</a>.</p>

<p>Quasar is developed by <a href="http://paralleluniverse.co">Parallel Universe</a> and released as free software, dual-licensed under the Eclipse Public License and the <span class="caps">GNU</span> Lesser General Public&nbsp;License.</p>

<h2 id="news">News</h2>

<h3 id="january-22-2014">January 22,&nbsp;2014</h3>

<p>Galaxy <span class="caps">1.3</span> has been&nbsp;released.</p>

<p><a href="http://blog.paralleluniverse.co/post/29085615915/galaxy-internals-part-3">Galaxy’s Networking</a>. Part 3 of the Galaxy Internals blog post&nbsp;series.</p>

<h3 id="august-9-2012">August 9,&nbsp;2012</h3>

<p><a href="http://blog.paralleluniverse.co/post/29085615915/galaxy-internals-part-3">Galaxy’s Networking</a>. Part 3 of the Galaxy Internals blog post&nbsp;series.</p>

<h3 id="august-3-2012">August 3,&nbsp;2012</h3>

<p><a href="http://blog.paralleluniverse.co/post/28635713418/how-galaxy-handles-failures&gt;">How Galaxy Handles Failures</a>. Part 2 of the Galaxy Internals blog post&nbsp;series.</p>

<h3 id="july-26-2012">July 26,&nbsp;2012</h3>

<p><a href="http://blog.paralleluniverse.co/post/28062434301/galaxy-internals-part-1">How Galaxy Maintains Data Consistency in the Grid</a>.</p>

<h3 id="july-10-2012">July 10,&nbsp;2012</h3>

<p>The first public version of Galaxy, <strong><span class="caps">1.0</span>-alpha1</strong>, has been&nbsp;released.</p>

<p>See the announcement <a href="http://blog.paralleluniverse.co/post/26909672264/on-distributed-memory">on our blog</a>.</p>

<h1 id="getting-started">Getting&nbsp;Started</h1>

<h3 id="system-requirements">System&nbsp;requirements</h3>

<p>Galaxy requires that the Java Runtime Environment (<span class="caps">JRE</span>) version 7 will be installed on your&nbsp;machine.</p>

<h3 id="downloading-galaxy">Downloading&nbsp;Galaxy</h3>

<p>You can download the Galaxy distribution from&nbsp;here:
<a href="http://paralleluniverse.co/docs/galaxy-1.0-SNAPSHOT.zip">Release&nbsp;<span class="caps">1.0</span></a></p>

<h3 id="building-galaxy">Building&nbsp;Galaxy</h3>

<p>To build galaxy, simply <code>cd</code> to the Galaxy directory, then&nbsp;run:</p>

<div class="highlight"><pre><code><span id="line-1">gradle
</span></code></pre></div>
<p>If you don’t have gradle installed on your machine then run&nbsp;instead:</p>

<div class="highlight"><pre><code><span id="line-1">./gradlew
</span></code></pre></div>
<p>To build the documentation, you need to have <a href="http://sphinx.pocoo.org/">Sphinx</a> and <a href="http://lesscss.org/">lessc</a> installed. Then&nbsp;run:</p>

<div class="highlight"><pre><code><span id="line-1">gradle generateDocs
</span></code></pre></div>
<h3 id="using-maven">Using&nbsp;Maven</h3>

<p>Add the following dependency to&nbsp;Maven:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;dependency&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;groupId&gt;</span>co.paralleluniverse<span class="nt">&lt;/groupId&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;artifactId&gt;</span>galaxy<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
</span><span id="line-5"><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<h3 id="pre-built">Using the pre-built&nbsp;configurations</h3>

<p>The user manual explains, at length, how to configure Galaxy (see <a href="#config">Configuring and Monitoring Galaxy</a>). However, for your convenience, a number of pre-built configurations are included with the Galaxy distribution, and can be found in the <code>config</code>&nbsp;directory.</p>

<p>While normally you’d have one large <span class="caps">XML</span> file with Galaxy’s configuration, these sample configurations are divided into snippet <span class="caps">XML</span> files (those <span class="caps">XML</span> files starting with an underscore in the <code>config</code> directory) that you can mix and&nbsp;match.</p>

<h4 id="peer-configuration">Peer&nbsp;configuration</h4>

<p>Regular Galaxy cluster nodes are called “peers”, and to configure a peer, take a look at <code>peer.xml</code> in the <code>config</code> directory. It contains three or four <span class="caps">XML</span> <code>import</code>&nbsp;elements:</p>

<ol>
  <li>
    <p><code>_peer.xml</code>. This import is required for all peer&nbsp;configurations.</p>
  </li>
  <li>Cluster management product. Can be one&nbsp;of:
    <ul>
      <li><code>_jgroups.xml</code> - to use&nbsp;JGroups.</li>
      <li><code>_zookeeper.xml</code> - to use Apache ZooKeeper. If selected, configure <code>zkConnectString</code> in <code>_zookeeper.xml</code> to match your ZooKeeper&nbsp;configuration.</li>
    </ul>
  </li>
  <li>One&nbsp;of: 
    <ul>
      <li><code>_with_server.xml</code> - if you’d like your cluster to have a server node for persistence (see <a href="#config-server">Configuring, Running and Monitoring the Server</a> for an explanation about&nbsp;servers).</li>
      <li><code>_with_cloud_server.xml</code> - if you want a server but are running Galaxy in a cloud environment that does not allow multicast. In that case, you must use <code>_zookeeper.xml</code>.* <code>_with_dumb_server</code> - if you’d like to use a server that isn’t a Galaxy node but a simple <span class="caps">SQL</span> database for&nbsp;persistence.
  In this case, you must also import <code>_sql.xml</code> as item 4 (see <a href="#config-server-dumb">Dumb servers</a> for an explanation about dumb&nbsp;servers).</li>
      <li><code>_no_server.xml</code>- if you don’t want a server at&nbsp;all.</li>
    </ul>
  </li>
  <li>Possibly <code>_sql.xml</code>, if and only if you’ve chosen <code>_with_dumb_server</code>.If chosen, edit <code>_sql.xml</code> with your database connection information. See <a href="#config-server-store-jdbc">Using <span class="caps">SQL</span></a> for more information about configuring the <span class="caps">RDBMS</span>&nbsp;integration.</li>
</ol>

<p class="alert alert-info"><strong>Note</strong>: It is recommended that you configure your cluster to use a server node or a dumb server. See <a href="#config-cluster-organization-serverless">Should you use a server?</a>.</p>

<p>In addition to this file, you’ll need to edit an additional <code>.properties</code> file. You must provide these properties (you can edit <code>peer.properties</code> in the <code>config</code>&nbsp;directory):</p>

<ol>
  <li>
    <p><code>galaxy.nodeId</code> - this will identify the node in the cluster. Two or more nodes with the same id will form a “backup group” (see <a href="#api-cluster-organization-backup">Backup groups</a>).</p>
  </li>
  <li>
    <p><code>galaxy.port</code> - this is the <span class="caps">UDP</span> port that Galaxy will use to send messages among peer&nbsp;nodes.</p>
  </li>
  <li>
    <p><code>galaxy.slave_port</code> - if there are more than one nodes with the same id, the slaves of the peer group will connect to this <span class="caps">TCP</span> port on the master to receive backup&nbsp;data.</p>
  </li>
  <li>
    <p><code>galaxy.multicast.address</code> - the <span class="caps">IP</span> address to use for multicast (not used when <code>_with_cloud_server</code> is&nbsp;chosen).</p>
  </li>
  <li>
    <p><code>galaxy.multicast.port</code> - the <span class="caps">IP</span> port to use for multicast (not used when <code>_with_cloud_server</code> is&nbsp;chosen).</p>
  </li>
</ol>

<p>Properties 4 and 5 must be the same for all peer nodes. Properties 2 and 3 may be different for each node (this is especially useful when running several nodes on the same machine for testing). The <code>nodeId</code> property should be different or each node (but the same for nodes in the same backup&nbsp;group).</p>

<p class="alert alert-info"><strong>Note</strong>: If you create several peer properties files with different ports, you can run several peers on a single&nbsp;machine!</p>

<h4 id="server-configuration">Server&nbsp;configuration</h4>

<p>If you heed our recommendation and want to use Galaxy with a server node (or more, though, currently, only a single server node is supported), you’re going to need to configure it. Just like with peers, you should start by looking at the <code>server.xml</code> file that’s in the <code>config</code> directory. It is comprised of three <span class="caps">XML</span> <code>import</code>&nbsp;elements:</p>

<ol>
  <li>
    <p><code>_server.xml</code>. This import is required for all peer&nbsp;configurations.</p>
  </li>
  <li>Cluster management product. Can be one&nbsp;of:
    <ul>
      <li><code>_jgroups.xml</code> - to use&nbsp;JGroups.</li>
      <li><code>_zookeeper.xml</code> - to use ZooKeeper. If selected, configure <code>zkConnectString</code> in <code>_zookeeper.xml</code> to match your ZooKeeper&nbsp;configuration.</li>
    </ul>
  </li>
  <li>Persistence layer. Can be one&nbsp;of:
    <ul>
      <li><code>_bdb.xml</code> - to use Berkeley <span class="caps">DB</span>, Java Edition as the persistence engine. If you choose to use <span class="caps">BDB</span> <span class="caps">JE</span>, you might want to change the <code>envHome</code> property, defined in&nbsp;the
<code>_bdb.xml</code> file, to point to the directory where you want to place the <span class="caps">BDB</span> files, and the <code>truncate</code> property (which can be <code>true</code> or <code>false</code>) depending on whether or not you want the database truncated (cleared) upon server&nbsp;startup.
See <a href="#config-server-store-bdb">Using Berkeley<span class="caps">DB</span></a> for more information about configuring&nbsp;<span class="caps">BDB.</span></li>
      <li><code>_sql.xml</code> - to use a <span class="caps">SQL</span> database with a <span class="caps">JDBC</span> driver for persistence.If chosen, edit <code>_sql.xml</code> with your database connection&nbsp;information.
See <a href="#config-server-store-jdbc">Using <span class="caps">SQL</span></a> for more information about configuring the <span class="caps">RDBMS</span>&nbsp;integration.
Because you’re using a server node and peers would need to access it over the network, it’s best that you runthe server on the same machine running the <span class="caps">DB</span> to save the extra network hop. This should actually provide better performance than using the <span class="caps">DB</span> as a dumb server as explained&nbsp;above.</li>
    </ul>
  </li>
</ol>

<p>For the server, too, you’ll need to edit <code>server.properties</code> in the <code>config</code> directory. Leave <code>galaxy.nodeId</code> set to <code>0</code> - this is what identifies the node as the server. But set <code>galaxy.port</code> to the <span class="caps">TCP</span> port you want the peers to use when connecting to the&nbsp;server.</p>

<h3 id="running-galaxy">Running&nbsp;Galaxy</h3>

<p>The Galaxy server runs as a standalone process. The peers are your application code that calls into the Galaxy library. Note that if you’re using ZooKeeper, you must start the ZooKeeper servers before starting any Galaxy&nbsp;nodes.</p>

<h4 id="running-the-server">Running the&nbsp;server</h4>

<p>To run the server, simply run the executable Java class <code>co.paralleluniverse.galaxy.Server</code>, and pass it two command-line arguments: the <span class="caps">XML</span> configuration file and the properties file, like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1">java -classpath galaxy.jar co.paralleluniverse.galaxy.Server config/server.xml config/server.properties
</span></code></pre></div>
<h4 id="using-the-peers">Using the&nbsp;peers</h4>

<p>In your application code, you need to get an instance of the <code>Grid</code> <a href="#api">class</a> , which is the entry point to Galaxy’s <span class="caps">API.</span> You do it by calling the <code>getInstance</code> static method, and passing it the location of the <span class="caps">XML</span> and properties files you have configured in the <a href="#pre-built">configuration step</a>, like&nbsp;this:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">Grid</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;config/peer.xml&quot;</span><span class="o">,</span> <span class="s">&quot;config/peer1.properties&quot;</span><span class="o">);</span>
</span></code></pre></div>
<p>(depending on your current directory you may need to provide a different path to the <span class="caps">XML</span> and properties&nbsp;files.)</p>

<p>Usually, your next statement would be to tell the node to go&nbsp;online:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">grid</span><span class="o">.</span><span class="na">goOnline</span><span class="o">();</span>
</span></code></pre></div>
<p>Now you should read the <a href="#api"><span class="caps">API</span> section</a> of the manual to learn how to use the Galaxy&nbsp;<span class="caps">API.</span></p>

<h1 id="user-manual">User&nbsp;Manual</h1>

<p>This document explains how to use and configure Galaxy. Running Galaxy is about equal parts configuration and <span class="caps">API</span> so&nbsp;you’re
advised to read this manual in its&nbsp;entirety.</p>

<h2 id="introduction-to-galaxy">Introduction to&nbsp;Galaxy</h2>

<p>Galaxy is an in-memory data-grid. It’s main function is to distribute data objects (stored as simple byte arrays) among&nbsp;cluster 
nodes for distributed processing. It also provides point-to-point messaging with guaranteed delivery and guaranteed ordering, as well as a cluster&nbsp;configuration
management&nbsp;service.</p>

<h3 id="intro-architecture">Galaxy Features and&nbsp;Architecture</h3>

<p><strong><span class="caps">RAM</span> storage and code/data&nbsp;co-location</strong></p>

<p>Application code runs on the same cluster nodes (called <strong>peer nodes</strong>), and processes the data objects which are kept in <span class="caps">RAM.</span> Unlike other IMDGs that partition data items, and distribute them in such a way that each object is the responsibility of a single node, Galaxy nodes exchange messages to transfer ownership of objects from one node to another. This means that if the application code in one of the nodes regularly updates some data items, those items will be owned by the node, and will be available for processing and update without any network I/O. As the application runs, items will migrate from one node to another (though items can reside on several nodes at once for read-only access). This gives the application precise control over the location of the data in the cluster for maximum&nbsp;performance. </p>

<p>This flexibility, however, is suitable when data access patterns can be predicted and so the data can be optimally placed. If data access is completely random, other IMDGs may be a better choice as they can retrieve or update any item at a cost of one network hop, while Galaxy might need to search the cluster for an unexpected item&nbsp;access.</p>

<p>Because the application code is co-located with the data, and because all of the data is kept in <span class="caps">RAM</span>, Galaxy is suitable for low-latency&nbsp;applications.</p>

<p><strong>Consistency</strong></p>

<p>Galaxy stores data in a fully consistent manner, meaning that if data item B has been modified after a change to data item A, no node in the cluster will see A’s new value but B’s old&nbsp;one.</p>

<p>Galaxy achieves consistency by using a <a href="http://en.wikipedia.org/wiki/Cache_coherence">cache-coherence protocol</a> similar tothe protocols used to coordinate memory access among <span class="caps">CPU</span> cores. However, as Galaxy can guarantee the ordering of coordination messages between nodes no memory-fence operations are requires (as they are in CPUs) to achieve&nbsp;consistency.</p>

<p><strong>Disk persistence and server&nbsp;nodes</strong></p>

<p>The data items can optionally be persisted to disk on one or more special nodes called <a href="#config-server">server nodes</a>.</p>

<p>However, in order to keep latency low, Galaxy (even when configured to use a persistent server node), is not durable. This means that a failure in one or more of the nodes may result in a permanent loss of some <em>recent</em> updates. However, even in cases of such failures the data remains consistent, meaning the lost updates will be lost to all of the nodes (or to&nbsp;none).</p>

<p><strong>High&nbsp;Availability</strong></p>

<p>Galaxy can withstand a failure in one or more of the nodes, providing high-availability. This is achieved by either running Galaxy with a server node (which persists all of the grid data to disk) or by running a slave node (or more) for each of the peers, or&nbsp;both.</p>

<p>If only a server node is used, data is not lost when a peer node fails (except for possibly some recent updates as explained above), and all the data items owned by the failed node are still accessible. However, as the server reads those items from the disk, latency might suffer until all items have been accessed by the peers and kept in&nbsp;<span class="caps">RAM.</span></p>

<p>Alternately, or in combination with a server, you can run one or more slave-nodes for each of the peers, that mirror the data stored in them, so that upon failure of a peer, one of its slaves will take over, already having all of the necessary data items in&nbsp;<span class="caps">RAM.</span></p>

<p>A server node may also have slaves that will take over when it&nbsp;fails.</p>

<p><strong>Messaging</strong></p>

<p>Galaxy provides a point-to-point messaging service that guarantees message delivery and ordering. A message can be sent to a known node or to the unknown (to the application) owner of a given data item. So if Galaxy’s data-item migration makes moving data to code simple, Galaxy’s messages make moving an operation (code) to data just as&nbsp;simple.</p>

<p>The application messages are delivered by the same communication channel that delivers Galaxy’s internal coherence protocol messages, so messages are also  guaranteed to be ordered with data operations. Say that node A updates data item X, and then sends a message to the owner of data item Y (which happens to be node B), as a result of which node B reads the value of X. In this case node B is guaranteed to read the value of X after the update done by A before sending the&nbsp;message.</p>

<p><strong>Monitoring</strong></p>

<p>All of Galaxy’s components are monitored to enable full diagnoses of failure or performance&nbsp;problems.</p>

<p>Galaxy’s aim is to give the application full control over data location and processing in the grid, and in-order to provide maximal flexibility with a simple <span class="caps">API</span>, it is relatively low-level. It provides no query mechanism whatsoever, imposes no structure on the data (which is kept in memory and on disk as byte arrays), and provides no locking of elements to coordinate complex transactions among different threads on a single node (although each operation is atomic by itself). All of that must be&nbsp;provided
by the&nbsp;application.</p>

<p class="alert alert-info"><strong>Note</strong>: Use data-store operations to move data to code; use messages to move code to&nbsp;data.</p>

<h3 id="galaxy-internals">Galaxy&nbsp;Internals</h3>

<p>A series of blog posts detailing Galaxy’s inner workings can be found&nbsp;here: 
<a href="http://blog.paralleluniverse.co/post/28062434301/galaxy-internals-part-1">part 1</a>, 
<a href="http://blog.paralleluniverse.co/post/28635713418/how-galaxy-handles-failures&gt;">part 2</a>, 
<a href="http://blog.paralleluniverse.co/post/29085615915/galaxy-internals-part-3">part 3</a>.</p>

<h3 id="tips-for-achieving-high-performance-with-galaxy">Tips for Achieving High-Performance with&nbsp;Galaxy</h3>

<ul>
  <li>Reduce contention - just like in all distributed systems (and even inside your <span class="caps">CPU</span>), contention <em>invariably</em> requires&nbsp;communication
and communication invariably increases latency. Try to avoid multiple nodes all competing to update the same&nbsp;items.</li>
  <li>The more nodes share an item, the less often it should be updated - even if an item is usually updated by the same node, if the&nbsp;item
is shared (for read access), by a large number of nodes, updating it will increase latency (in the reader nodes, not the writer&nbsp;node).</li>
  <li>Trees are good - Tree data structures (like B-trees and tries) often have the property that the higher up a tree-node is, it will&nbsp;be
shared more, but will be updated less often. That’s a great&nbsp;property.</li>
  <li>Keep your transactions short - this will also reduce contention. Try not to do any blocking operation while in a Galaxy&nbsp;transaction.</li>
  <li>Consider configuring your Ethernet network to use jumbo frames - if your network supports it, jumbo frames may improve&nbsp;communication
speed among Galaxy&nbsp;nodes.</li>
</ul>

<h2 id="api">Galaxy’s&nbsp;<span class="caps">API</span></h2>

<p>Galaxy’s Grid <span class="caps">API</span> (which is fully documented in the <a href="http://puniverse.github.io/galaxy/javadoc/index.html">Javadoc</a>) is found in the package&nbsp;<code>co.paralleluniverse.galaxy</code>. </p>

<h3 id="getting-the-grid-instance">Getting the grid&nbsp;instance</h3>

<p>To get an instance of the galaxy grid, represented by the <code>Grid</code> class (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Grid.html">Javadoc</a>), simply&nbsp;call  </p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">Grid</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span></code></pre></div>
<p>Usually, your next statement would be to tell the node to go&nbsp;online:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">grid</span><span class="o">.</span><span class="na">goOnline</span><span class="o">();</span>
</span></code></pre></div>
<p>See <a href="#api-cluster-organization">Cluster organization</a> for more details about node&nbsp;states.</p>

<p class="alert alert-info"><strong>Note</strong>: See <a href="#config">Configuring and Monitoring Galaxy</a> for information about configuring the&nbsp;grid. </p>

<h3 id="grid-services">Grid&nbsp;services</h3>

<p>The Galaxy grid provides three&nbsp;services:</p>

<ul>
  <li><a href="#api-store">Data&nbsp;Store</a> </li>
  <li><a href="#api-messenger">Messenger</a> </li>
  <li><a href="#api-cluster">Cluster&nbsp;Management</a> </li>
</ul>

<p>The <a href="#data-store">data store</a> service (accessed through the interface <code>Store</code>) provides all operations on grid data items. To obtain an instance of the <code>Store</code>,&nbsp;call</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">Store</span> <span class="n">store</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="na">store</span><span class="o">();</span>
</span></code></pre></div>
<p>The <a href="#api-messenger">messenger</a> service (accessed through the interface <code>Messenger</code>) allows sending point-to-point messages over the grid that work in concert with the data store service. You can obtain an instance of the <code>Messenger</code>, by&nbsp;calling</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">Messenger</span> <span class="n">messenger</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="na">messenger</span><span class="o">();</span>
</span></code></pre></div>
<p>The <a href="#api-cluster">cluster</a> service (accessed through the <code>Cluster</code> interface), is used internally by Galaxy to manage the cluster (handle membership changes, leader election etc.) but can be used by client application as well. It provides a nice mechanism for sharing configuration data among nodes. The <code>Cluster</code> instance is obtained&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="na">cluster</span><span class="o">();</span>
</span></code></pre></div>
<h4 id="api-store">Data&nbsp;Store</h4>

<p>The grid’s shared data store is accessed through the <code>Store</code> class (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html">Javaoc</a>)
which is used for all operations on data&nbsp;items.</p>

<h5 id="api-store-items">Data&nbsp;items</h5>

<p>Galaxy data items are simple byte arrays, which are assigned a unique <code>long</code> identifier by the grid. You cannot choose the id given to a data item (Galaxy is <em>not</em> a key value store), so you are responsible for storing the item ids in your object graph (you can think of item ids as the grid version of references). This is all because Galaxy is meant to be used to implement any kind of distributed data structure (you can implement a distributed map on top of Galaxy and thus build your own key-value&nbsp;store).</p>

<p>To get an item’s id, you would either read it from another item (like following a reference), or read it from a&nbsp;message 
(see <a href="#api-messenger">Messenger</a>). However, all cluster nodes need a way to easily find the root (or roots) of the object graph, and for this purpose, Galaxy provides root&nbsp;items.</p>

<h6 id="root-items">Root&nbsp;items</h6>

<p>A root item is a data item which you’d like to access without knowing its id in advance. Roots are found using string identifiers of your own choosing. When a root is first located, it will be allocated, but only by one of the nodes accessing it. So if several cluster nodes are all accessing the same root, one will be responsible for initializing it (if it has not already been created before), and the rest of the nodes will observe the initialized root. This ensures that any node will either find an initialized root, or be assigned the task of initializing it (this will only happen once for each&nbsp;root).</p>

<p>Finding a root is done by calling  the <code>getRoot</code> method within a transaction (<code>getRoot</code> is the only <code>Store</code> operation that requires a transaction. For all other operations, transactions are optional. Transactions are fully explained later in this chapter), like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="kt">long</span> <span class="n">root</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span><span id="line-2"><span class="n">StoreTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span id="line-3"><span class="k">try</span> <span class="o">{</span>
</span><span id="line-4">    <span class="n">root</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getRoot</span><span class="o">(</span><span class="s">&quot;myRootName&quot;</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-5">    <span class="k">if</span> <span class="o">(</span><span class="n">store</span><span class="o">.</span><span class="na">isRootCreated</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">txn</span><span class="o">)</span> 
</span><span id="line-6">        <span class="n">store</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">initialRootData</span><span class="o">(),</span> <span class="n">txn</span><span class="o">);</span> <span class="c1">// initialize root</span>
</span><span id="line-7">    <span class="n">store</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-8"><span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-9">    <span class="n">store</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-10">    <span class="n">store</span><span class="o">.</span><span class="na">abort</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-11"><span class="o">}</span>
</span></code></pre></div>
<p>Locating a root by its name can be costly, so only locate a root once (during application startup) and store its id for future&nbsp;accesses.</p>

<p class="alert alert-warn"><strong>Note</strong>: Do not use the root mechanism as a general key-value store. Roots were designed to be accessed by their string identifiers only rarely (usually only when the application starts). Locating a root by its name is a costly&nbsp;operation.</p>

<h6 id="serialization-and-persistables">Serialization and&nbsp;Persistables</h6>

<p>In order to represent application objects, you can use any serialization mechanism, such as <code>java.io</code> serialization, <a href="http://code.google.com/p/protobuf/">Protocol Buffers</a>, [Kryo] or any other. However, for best serialization performance, it is best to have your data objects implement the <code>Persistable</code>&nbsp;interface.</p>

<p>The <code>Persistable</code> interface (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/common/io/Persistable.html">Javadoc</a>) provides direct access to galaxy’s internal <code>ByteBuffers</code>, and eschews copying data to and from byte arrays. All of the <code>Store</code>’s data methods (<code>get</code>, <code>set</code>, <code>put</code> etc.) have versions that work with&nbsp;<code>Persistables</code>.
Just make sure never to modify the <code>ByteBuffer</code>’s contents inside your implementation of&nbsp;<code>Persistable</code>’s
<code>read</code>&nbsp;method.</p>

<h6 id="api-store-items-allocation">Allocating&nbsp;items</h6>

<p>Root items are allocated automatically. All other items must be allocated explicitly using one of the <code>put</code> methods or with the <code>alloc</code>&nbsp;method.</p>

<p>The <code>alloc</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#alloc(int, co.paralleluniverse.galaxy.StoreTransaction)">Javadoc</a>)
allocates one or more items. The items allocated are empty (i.e. contain nulls), and can be set with one of the<code>set</code> methods. This method is mostly intended for allocating arrays - a block of items with consecutive ids. The return value is the identifier for the first allocated item, with subsequent ids assigned to the following allocated&nbsp;items.</p>

<p>The <code>put</code> methods allocates a new item and sets its value (there are variants taking values of different types - array, <code>ByteBuffer</code> and&nbsp;<code>Persistable</code>). 
It returns the newly allocated item&nbsp;id.</p>

<h6 id="reading-items">Reading&nbsp;items</h6>

<p>To read an items value, simply pass its id to one of the <code>get</code>&nbsp;methods.</p>

<ul>
  <li>To learn about reading items within transactions, see <a href="#api-store-transactions">Transactions</a>.</li>
  <li>To learn about reading items asynchronously, see <a href="#api-store-async">Asynchronous operations</a>.</li>
  <li>To learn about the effect <code>get</code> has over item ownership, see <a href="#api-store-ownership">Item ownership</a>.</li>
</ul>

<h6 id="hinted-reads">Hinted&nbsp;reads</h6>

<p>Sometimes your application may know which node likely owns a certain item (say if this information was conveyed in a <a href="#api-messenger">message</a>) or that an item is likely owned by the same node that currently owns a different item (if this is how your distributed data structure behaves). In such cases, you can provide hints to the <code>get</code> method as to the item’s owner, which may sometimes be helpful in improving the running time of the operation (however, even if the hint is wrong and the item is not, in fact, stored on the hinted node, the operation will still perform correctly and find the item wherever it&nbsp;is). </p>

<p>Some variants of the <code>get</code> method take a <code>nodeHint</code> parameter (a <code>short</code> value) that names the (supposed) owning&nbsp;node.</p>

<p>The <code>getFromOwner</code> methods take a second item id that points to an item which is likely owned by the same node that owns the requested item. Note that calling this method may only improve performance if the hinting item (the second parameter) is found on the local node (and so its owner is already&nbsp;known).</p>

<h6 id="writing-items">Writing&nbsp;items</h6>

<p>To write an item’s value, use one of the <code>set</code>&nbsp;methods.</p>

<ul>
  <li>To learn about writing items within transactions, see <a href="#api-store-transactions">Transactions</a>.</li>
  <li>To learn about writing items asynchronously, see <a href="#api-store-async">Asynchronous operations</a>.</li>
  <li>To learn about the effect <code>set</code> has over item ownership, see <a href="#api-store-ownership">Item ownership</a>.</li>
</ul>

<h5 id="deleting-items">Deleting&nbsp;items</h5>

<p>An item can be deleted with the <code>del</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#del(long, co.paralleluniverse.galaxy.StoreTransaction)">Javadoc</a>).</p>

<p>Trying to access (<code>get</code> or <code>set</code>) a deleted item will result in an exception, but you should not rely on that to detect deleted items (making sure an item is deleted might be costly). Instead, try to only delete items when they are no longer “referenced” by any other item (i.e., they are&nbsp;unreachable).</p>

<h5 id="api-store-ownership">Item&nbsp;ownership</h5>

<p>As explained in the <a href="#intro-architecture">introduction</a>, Galaxy is different from other IMDGs in that item ownership can move between cluster nodes during normal operation. This will now be explained in further&nbsp;detail.</p>

<h6 id="owned-items-and-shared-items">Owned items and shared&nbsp;items</h6>

<p>Whenever you access a Galaxy data item in your application, it is sent to the cluster node your code is running on. The&nbsp;item
is then stored in <span class="caps">RAM</span> in one of two states: <strong>owned</strong> or <strong>shared</strong>.</p>

<p>Every Galaxy data item is <strong>owned</strong> by exactly one node at any point in time, but can be <strong>shared</strong> by many. All&nbsp;nodes
<strong>sharing</strong> an item can read its value, but only the <strong>owning</strong> node can write it. The owning node and sharing nodes for&nbsp;each
item change based on the operations the program performs. You can check whether an item is shared, owned or non-existent&nbsp;in 
any particular node by calling the <code>getState</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#getState(long)">Javadoc</a>).</p>

<h6 id="sharing-an-item">Sharing an&nbsp;item</h6>

<p>When you call the <code>get</code> method (any of its variants), if the item is not found on the local node (in either a shared or an owned state), it will be fetched from the owning node, and kept in <span class="caps">RAM</span> in the shared state, until the owning node invalidates it (when the item value is changed). Any further reads (with <code>get</code>) will complete immediately with no required network&nbsp;operations.</p>

<p>The <code>gets</code> method (all of its variants) is very similar to <code>get</code>, except that the item will remain shared on the current node until it is explicitly released. In other words, the item is <em>pinned</em> to this node in the shared state. You shouldn’t keep the item pinned for long, because as long as it’s pinned to the local node, it’s value cannot be changed by the owning node! (this is not exactly true - see <a href="#api-store-ownership-inner">Inner Workings</a>.</p>

<p>To release a pinned item, you must call the <code>release</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#release(long)">Javadoc</a>) or use the <code>gets</code> method in a <a href="#api-store-transactions">transaction</a>.</p>

<h6 id="owning-an-item">Owning an&nbsp;item</h6>

<p>In order for an item to be written (with the <code>set</code> method), it must be owned by the local node, and it must not be shared by any other node (we then say that the item is <strong>exclusive</strong> in the calling node). So, when you call the <code>set</code> method, ownership of the item is transferred to the calling node, and all sharing nodes are asked to invalidate their copies of the&nbsp;item.</p>

<p>The <code>getx</code> method (all of its variants) reads an item’s value, but first it obtains ownership over it, and invalidates all sharers. In other words, it <em>pins</em> the item to the local node in the <strong>exclusive</strong> state. As long as the item is pinned, no other node can <em>read or write</em> the item (this, too, is not exactly true - see <a href="#api-store-ownership-inner">Inner Workings</a>, so you should release it as soon as possible. <code>getx</code> is essentially a “get for write” operation, used to read the the item with the intent to soon modify it with&nbsp;<code>set</code>.</p>

<p>To release a pinned item, you must call the <code>release</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#release(long)">Javadoc</a>) or use the <code>getx</code> method in a <a href="#api-store-transactions">transaction</a>.</p>

<h6 id="api-store-ownership-deadlock">Deadlocks</h6>

<p>Because <code>getx</code> and <code>gets</code> pin an item to the local node until it is explicitly released, pinning more than one item&nbsp;can 
result in a deadlock. For example if node A pins item X in a shared mode (using <code>gets</code>) and then wishes to pin item Y in&nbsp;the
exclusive mode (with <code>getx</code>), while, at the same time node B pins Y in the shared mode and wishes to pin X in the exclusive&nbsp;mode,
a conflict may occur which will result in both nodes A and B unable to complete their operation. This is called a <strong>deadlock</strong>.</p>

<p>When deadlock occurs, the failed operation will throw a <code>TimeoutException</code>. If this happens, you must undo all&nbsp;writes
that have succeeded to relevant items and release all pinned items in order to allow the other node to complete its&nbsp;operation. 
Then, you may retry the operation. <a href=": #api-store-transactions">Transactions</a> make dealing with timeouts&nbsp;easier.</p>

<p>See <a href="#config-comm-common-timeout">Timeout</a> for instructions on setting the timeout&nbsp;duration.</p>

<p class="alert alert-info"><strong id="api-store-ownership-inner">Note</strong>: <strong>Inner&nbsp;Workings-</strong>
When <code>set</code> or <code>getx</code> are called, the caller does not actually wait for all sharers to invalidate the items&nbsp;before
modifying it. Galaxy assumes that if a tree falls in the forest and no one is around to hear it, it does not make a&nbsp;sound,
so some lengthy operations are allowed to proceed as long as no other node can have access to the&nbsp;item.
Therefore, <code>set</code> or <code>getx</code> will complete before all sharers have invalidated their copies, but the item’s new&nbsp;value
will not be made available to other nodes until they do so. In fact, this is also done with high availability backup&nbsp;data
(to the server or slave nodes). Writes do not wait for the server or slaves to acknowledge the backup, but other nodes&nbsp;cannot
read the item’s new value until the backup has been&nbsp;completed.
Neither is it entirely true that items pinned in the exclusive mode (with <code>getx</code>) cannot be read by other nodes. In&nbsp;fact
Galaxy allows nodes to read an exclusively pinned item’s old value (as it had been before it was pinned), provided&nbsp;that
the item is found on that node (because it was once a sharer or an owner of the item), and provided that reading the&nbsp;value
will not violate consistency guarantees. In any case, Galaxy never allows reading (or writing) an item in a way that will&nbsp;violate
consistency.</p>

<h5 id="api-store-listeners">Listeners</h5>

<p>You can listen for changes in an item’s value by providing a listener to the method <code>setListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#setListener(long, co.paralleluniverse.galaxy.CacheListener)">Javadoc</a>),
which will get notified of events pertaining to a specific item. Only one listener can be set for a given item, and it may be&nbsp;removed
by passing a <code>null</code> listener to&nbsp;<code>setListener</code>.</p>

<p>A listener may be useful, say, for updating a deserialized representation of the&nbsp;item.</p>

<p>The listener implements three&nbsp;methods:</p>

<ul>
  <li><code>received</code> - called when a new value for the item has been received by the node when a <code>get</code> completes after the node’s&nbsp;value
has been changed by another node. Received will not be called when the value is modified by the local node, nor will it be&nbsp;called
when another node updates the item, but the local node has not requested its value with a <code>get</code> (or&nbsp;<code>gets/x</code>). 
That is, the listener does   not listen for all modifications done to the item, only those which are of interest to this&nbsp;node, 
namely only when a <code>get/s/x</code> has been&nbsp;issued.</li>
  <li><code>invalidated</code> - called when the item’s owner requested the item be invalidated by the local node (because it wants an&nbsp;exclusive
ownership for an update). Note that this does not necessarily mean that the item may not be read by the local node, as&nbsp;sometimes
Galaxy allows stale reads as long as they don’t break consistency (see <a href="#api-store-ownership-inner">Inner Workings</a>).</li>
  <li><code>evicted</code> - called when the item has been evicted entirely from the local node, either because it was a shared item that was&nbsp;not
accessed recently and Galaxy evicted it to conserve memory, because the item has been deleted, or because Galaxy has determined&nbsp;that 
it can no longer be read without violating&nbsp;consistency.</li>
</ul>

<h5 id="api-store-transactions">Transactions</h5>

<p>Transactions are used to make multi-item atomic operations easier to use. An atomic multi-item operation is one that&nbsp;potentially
modifies more than one item, and allows other nodes to observe the items’ values either as they were before the transaction&nbsp;started
or as they are once the transaction has completed. Internally, transaction simply track which items were pinned, and allows&nbsp;releasing
all of them with one simple method call (remember, an item pinned with <code>getx</code> cannot be observed by other&nbsp;nodes).</p>

<p>A transaction is started with the <code>beginTransaction</code> method, completed with the <code>commit</code> or <code>abort</code> method, and is used&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">StoreTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span id="line-2"><span class="k">try</span> <span class="o">{</span>
</span><span id="line-3">    <span class="kt">byte</span><span class="o">[]</span> <span class="n">valX</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">gets</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-4">    <span class="kt">byte</span><span class="o">[]</span> <span class="n">valY</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getx</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-5">    <span class="n">store</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">process</span><span class="o">(</span><span class="n">valX</span><span class="o">,</span> <span class="n">valY</span><span class="o">),</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-6">    <span class="n">store</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-7"><span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">TimeoutException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-8">    <span class="n">store</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span> <span class="c1">// or undo writes manually with a series of sets.</span>
</span><span id="line-9">    <span class="n">store</span><span class="o">.</span><span class="na">abort</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-10"><span class="o">}</span>
</span></code></pre></div>
<p>Note how you must explicitly undo your changes if the transaction fails - either using <code>rollback</code> or manually using&nbsp;<code>set</code>.
By default, transactions support the rollback operation, but this makes them slower (and consume more memory) as they must&nbsp;remember
items’ old values. You can disable this “redo log” in the configuration file (See <a href="#config-cache">Configuring and Monitoring the Cache</a>).</p>

<p>See <a href="#config-comm-common-timeout">Timeout</a> for instructions on setting the timeout&nbsp;duration.</p>

<h5 id="api-store-async">Asynchronous&nbsp;operations</h5>

<p>Galaxy works best when most data operations access items that are already stored on the local node (see <a href="#api-store-performance">Performance</a>). However, occasionally operations do require network hops (for ownership transfer etc.), and so may&nbsp;block.</p>

<p>The data-store <span class="caps">API</span> provides non-blocking versions to all data operations (called <code>getAsync</code>, <code>getsAsync</code>, <code>getxAsync</code>&nbsp;etc.)
that do not block, but instead return a <code>Future</code>. This is especially useful (and will give a significant performance&nbsp;boost)
when performing several operations that don’t each require the result of the previous one. In the worst case (when network <span class="caps">IO</span>&nbsp;is
required) this will result in all network requests being sent together instead of each being sent only after the previous&nbsp;has 
completed.</p>

<p>Here’s an&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">valX</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getsAsync</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-2"><span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">valY</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getxAsync</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-3"><span class="n">store</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">process</span><span class="o">(</span><span class="n">valX</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">valY</span><span class="o">.</span><span class="na">get</span><span class="o">()),</span> <span class="n">txn</span><span class="o">);</span> <span class="c1">// this call is synchronous</span>
</span></code></pre></div>
<p>When used in a transaction, <code>commit</code> (and <code>abort</code>) will automatically wait for all futures returned within the transactions (and&nbsp;will
so guarantee they are all complete when the transaction&nbsp;ends.</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">StoreTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span id="line-2">    
</span><span id="line-3"><span class="k">try</span> <span class="o">{</span>
</span><span id="line-4">    <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">valX</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getsAsync</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-5">    <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">valY</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">getxAsync</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-6">    <span class="n">store</span><span class="o">.</span><span class="na">setAsync</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">process</span><span class="o">(</span><span class="n">valX</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">valY</span><span class="o">.</span><span class="na">get</span><span class="o">()),</span> <span class="n">txn</span><span class="o">);</span>
</span><span id="line-7">    <span class="n">store</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-8"><span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">TimeoutException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span id="line-9">    <span class="n">store</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span> <span class="c1">// or undo writes manually with a series of sets.</span>
</span><span id="line-10">    <span class="n">store</span><span class="o">.</span><span class="na">abort</span><span class="o">(</span><span class="n">txn</span><span class="o">);</span>
</span><span id="line-11"><span class="o">}</span>
</span></code></pre></div>
<h5 id="api-store-multithreading">Multithreading</h5>

<p>All of <code>Store</code>’s methods are thread safe, and the <code>Store</code> instance may safely be used by multiple threads. However,&nbsp;Galaxy
was built to provide inter-node synchronization - not intra-node synchronization - and so pinning an item to the local&nbsp;node
entails no locking. Meaning, an item that was pinned with <code>getx</code> on one thread, will result in <code>getx</code> succeeding&nbsp;immediately
when called from another. Even transactions (which are a thin management layer over pinning) will easily trample over each&nbsp;other
if they touch the same items on different threads. Any synchronization among threads (such as locking) must be done by&nbsp;the 
application (or another layer of middleware on top of&nbsp;Galaxy).</p>

<p>By leaving locking to the application, Galaxy provides a lot of flexibility. For example, if used carefully, several&nbsp;threads
may cooperate in running the same Galaxy&nbsp;transaction.</p>

<h5 id="api-store-performance">Performance</h5>

<p>To fully enjoy Galaxy’s low-latency processing, abide by the following&nbsp;advice:</p>

<ul>
  <li>Reduce contention - just like in all distributed systems (and even inside your <span class="caps">CPU</span>), contention <em>invariably</em> requires&nbsp;communication
and communication invariably increases latency. Try to avoid multiple nodes all competing to update the same&nbsp;items.</li>
  <li>The more nodes share an item, the less often it should be updated - even if an item is usually updated by the same node, if the&nbsp;item
is shared (for read access), by a large number of nodes, updating it will increase latency (in the reader nodes, not the writer&nbsp;node).</li>
  <li>Trees are good - Tree data structures (like B-trees and tries) often have the property that the higher up a tree-node is, it will&nbsp;be
shared more, but will be updated less often. That’s a great&nbsp;property.</li>
  <li>Keep your transactions short - this will also reduce contention. Try not to do any blocking operation while in a Galaxy&nbsp;transaction.</li>
  <li>Use asynchronous operations when&nbsp;appropriate.</li>
</ul>

<h4 id="api-messenger">Messenger</h4>

<p>The <code>Messenger</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Messenger.html">Javadoc</a>)
lets you send point-to-point messages to other nodes in the cluster, and is used alongside the <a href="#api-store">Data store</a> to distribute your application in the grid. While Galaxy’s data-store moves data around the grid to be processed at the appropriate node (moving data to code), messages are used to request nodes to carry out&nbsp;operations
without migrating data (moving code to&nbsp;data).</p>

<p>There are two ways of routing your messages. You can send a message to a known node, or you can send it to the (unknown)&nbsp;owner
of a specific data&nbsp;item.</p>

<h5 id="api-messenger-topics">Message&nbsp;topics</h5>

<p>Messages are sent and received by <strong>topics</strong>. Topics are the mechanism by which messages are delivered to the&nbsp;appropriate 
recipient within the node. There are two kinds of topics you can use. <code>long</code> topics and <code>String</code>&nbsp;topics.</p>

<p>To receive messages, you register a listener that will receive all incoming messages sent to a specific topic in the local&nbsp;node.
You register receivers like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">messenger</span><span class="o">.</span><span class="na">addMessageListener</span><span class="o">(</span><span class="n">topic</span><span class="o">,</span> <span class="n">myListener</span><span class="o">);</span>
</span></code></pre></div>
<p>With <code>topic</code> being either a <code>String</code> or a <code>long</code>, and <code>myListener</code> is an object implementing&nbsp;<code>MessageListener</code>
(<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/MessageListener.html">Javadoc</a>).</p>

<p>When a message sent to <code>myTopic</code> on the local node is received, <code>myListener</code>’s <code>messageReceived</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/MessageListener.html#messageReceived(short, byte[])">Javadoc</a>) will be called, and passed the message payload and the sending&nbsp;node.</p>

<p>You remove a listener by calling&nbsp;<code>removeMessageListener</code>.</p>

<h5 id="api-messenger-routing">Routing&nbsp;messages</h5>

<p>One way of addressing messages is sending them to a well known node. You would usually use this option when replying to&nbsp;received
messages, in which case the original sender is passed to the <code>MessageListener</code>’s <code>messageReceived</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/MessageListener.html#messageReceived(short, byte[])">Javadoc</a>).</p>

<p>To send a message to a well known node use one of the <code>send</code> methods, and pass it the node id (a <code>short</code>), the topic&nbsp;(either
a <code>long</code> or a <code>String</code>), and the message payload, like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">messenger</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">topic</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span></code></pre></div>
<p>The other way of addressing messages is sending them to the owner of a known data item. To do that, use one of the&nbsp;<code>sendToOwnerOf</code>
methods, and pass it the item id, the topic and the message payload, like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">messenger</span><span class="o">.</span><span class="na">sendToOwnerOf</span><span class="o">(</span><span class="n">itemId</span><span class="o">,</span> <span class="n">topic</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span></code></pre></div>
<h5 id="api-messenger-delivery">Delivery&nbsp;guarantees</h5>

<p>Messages are guaranteed to be delivered, and to arrive in the order they were sent (i.e. two messages M and N that are sent in&nbsp;this 
order from node A to B, will be received by B in the same order, regardless of the messages’&nbsp;topics).</p>

<p>Messages are delivered by the same communication channel that delivers Galaxy’s internal coherence protocol messages used to&nbsp;move
data items around, so messages are also guaranteed to be ordered with data&nbsp;operations. </p>

<p>Say that node A updates data item X, and then sends a message M to the owner of data item Y (which happens to be node&nbsp;B), 
and as a result of receiving M, node B reads the value of&nbsp;X. 
In this case node B is guaranteed to read the value of X after the update done by A before sending the&nbsp;message.</p>

<p>These guarantees make it simple to distribute data processing in the&nbsp;grid.</p>

<h4 id="api-cluster">Cluster&nbsp;Management</h4>

<p>The <code>Cluster</code> interface (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html">Javadoc</a>) provides&nbsp;information
about cluster nodes, and emits cluster events (like nodes joining or leaving the cluster). It also allows for easy&nbsp;configuration
management.</p>

<p>While an application employing Galaxy does not have to use this service, it is very useful for all clustered applications.&nbsp;And
while the application is free to use any other software for cluster management, this service is being used internally by&nbsp;Galaxy,
so when this service detects a node going down - that’s when the data-store and messenger detect is as down, as&nbsp;well.</p>

<p>Internally, this service employs either <a href="http://zookeeper.apache.org/">Apache ZooKeeper</a> (through Netflix’s <a href="https://github.com/Netflix/curator">Curator</a> library) or <a href="http://www.jgroups.org/">JGroups</a> 
(see <a href="#config-cluster">Configuring the Cluster Component</a> for configuring Galaxy to use either&nbsp;option).
You can gain access to the underlying implementation by calling the <code>getUnderlyingResource</code>&nbsp;method 
(<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#getUnderlyingResource()">Javadoc</a>) which will return the <code>CuratorZookeeperClient</code> used by Galaxy for cluster management (which, in turn, can be further queried for the underlying <code>ZooKeeper</code> instance) or the JGroups <code>JChannel</code> used for cluster&nbsp;management.</p>

<h5 id="api-cluster-organization">Cluster&nbsp;organization</h5>

<p>Every Galaxy node in the cluster has a unique name (a <code>String</code>) which is automatically assigned to it, and an id (a&nbsp;<code>short</code>
value) which is assigned in the local configuration file (see <a href="#config-cluster">Configuring the Cluster Component</a>) and is not unique (it is shared&nbsp;among
all nodes in a backup group (see <a href="#api-cluster-organization-backup">Backup groups</a>). 
Node id <code>0</code> designates server nodes (see <a href="#api-cluster-organization-server">Server node</a>).</p>

<p>In addition, every node may expose additional properties (such as <span class="caps">IP</span> addresses, ports or any other information) to all other&nbsp;nodes
in the cluster. Some properties are used internally by Galaxy, but you can add your own (see <a href="#api-cluster-info-properties">Custom properties</a>).</p>

<p>Each node is, at any given moment, in one of three states: <strong>offline</strong>, <strong>joined</strong> or <strong>online</strong>.</p>

<ul>
  <li>An <strong>offline</strong> node is one that is not seen by the other nodes in the cluster, either because it is turned off,&nbsp;disconnected
from the network, or suffering from a software&nbsp;failure.</li>
  <li>A <strong>joined</strong> node is one which is seen by all other nodes, but does not participate in the data-grid, i.e. it cannot&nbsp;receive
messages or data-items. All it can do is observe other nodes’&nbsp;state.</li>
  <li>An <strong>online</strong> node is one which fully participates in the grid, either as a master or a&nbsp;slave 
(see <a href="#api-cluster-organization-backup">Backup groups</a>.</li>
</ul>

<p>When your application first starts, its node is in the offline state. When you get a grid instance (by calling&nbsp;<code>Grid.getInstance()</code>)
that’s when the node will try to join the cluster, and become <strong>joined</strong>.</p>

<p>To go online call&nbsp;<code>grid.goOnline()</code>.</p>

<h6 id="api-cluster-organization-server">Server&nbsp;node</h6>

<p>A server node (or nodes) is a special Galaxy node that doesn’t run application code, but is responsible for providing Galaxy&nbsp;data
with disk-based persistence. All of the data in the grid is persisted to disk on the server node, and is also automatically&nbsp;served
by it in case of a node&nbsp;failure. </p>

<p>The node server always has a node id of <code>0</code>, and, just like with regular nodes, you can have several server nodes in a backup&nbsp;groups
configuration for added&nbsp;availability.</p>

<p>See <a href="#config-cluster-common">Servers and Backup Groups</a> and <a href="#config-server">Configuring, Running and Monitoring the Server</a> for more information about configuring and running server&nbsp;node(s).</p>

<h6 id="api-cluster-organization-backup">Backup&nbsp;groups</h6>

<p>Galaxy nodes can be configured in backup groups. All nodes assigned the same node id in their configuration file will become&nbsp;part 
of the same backup group. At any given time, each live backup group has exactly one <strong>master</strong> node, and zero or more <strong>slave</strong>
nodes. The master node replicates all of its owned data items to its slaves so that they can take over in case it&nbsp;fails.</p>

<p>When the master node fails, one of its slaves will become the master and take over. However, a master node <em>can never become a slave</em>.
A slave node is notified of its new master status by an event (see <a href="#api-cluster-lifecycle">Lifecycle events</a>).</p>

<p>See <a href="#config-cluster-common">Servers and Backup Groups</a> for information about configuring backup&nbsp;groups.</p>

<h5 id="api-cluster-lifecycle">Lifecycle&nbsp;events</h5>

<p>You can listen for important lifecycle events with the <code>addLifeCycleListener</code> to which you pass your <code>LifeCycleListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/LifecycleListener.html">Javadoc</a>). The listener will be&nbsp;notified
of the following&nbsp;events:</p>

<ul>
  <li><code>online</code> - This event will get triggered when the node reaches the <strong>online</strong> state. The single boolean parameter&nbsp;tells
the node is a master or a slave (see <a href="#api-cluster-organization-backup">Backup groups</a>).</li>
  <li><code>offline</code> - This event will get triggered when the node goes offline for some reason. Obviously, if the node goes&nbsp;offline
due to a power failure, this event will not be&nbsp;triggered.</li>
  <li><code>switchToMaster</code> - This event will get triggered at a slave node when it becomes the master (when the previous master has&nbsp;gone
offline.</li>
</ul>

<p>You can also check the current state of the local node with the methods <code>isOnline</code> and&nbsp;<code>isMaster</code>.</p>

<p>You remove a lifecycle listener by calling&nbsp;<code>removeLifecycleListener</code>.</p>

<h5 id="api-cluster-events">Cluster&nbsp;events</h5>

<p>The <code>Cluster</code> service also sends notifications about occuronces in other cluster&nbsp;nodes. </p>

<p>If you hand a <code>NodeChangeListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/NodeChangeListener.html">Javadoc</a>)
to <code>addNodeChangeListener</code> you’ll be notified when a new node (actually, a backup group) comes online, when it goes&nbsp;offline,
and when it has a master&nbsp;switchover.</p>

<p>A <code>SlaveConfigurationListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/SlaveConfigurationListener.html">Javadoc</a>) 
passed to <code>addSlaveConfigurationListener</code> will notify you when a slave is added to or removed from your local node’s backup&nbsp;group.</p>

<h5 id="api-cluster-info">Node&nbsp;information</h5>

<p>The <code>Cluster</code> interface has methods that return information about the local node and all other cluster&nbsp;nodes.</p>

<p>The <code>getMyNodeId</code> method returns the local node’s id, and the <code>getNodes</code> method returns the ids of all online nodes&nbsp;(actually
all online backup groups. Remember, the node id is shared by all nodes in the&nbsp;group).</p>

<h6 id="nodeinfo">NodeInfo</h6>

<p>The <code>NodeInfo</code> interface (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/NodeInfo.html">Javadoc</a>) let’s you access the configuration record published by any node in the&nbsp;cluster.</p>

<p><code>getMyNodeInfo</code> returns the <code>NodeInfo</code> of the local node, so by&nbsp;calling</p>

<div class="highlight"><pre><code><span id="line-1"><span class="n">grid</span><span class="o">.</span><span class="na">cluster</span><span class="o">().</span><span class="na">getMyNodeInfo</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>
</span></code></pre></div>
<p>you can get the local node’s unique&nbsp;name.</p>

<p>There are other methods in the <code>Cluster</code> interface that let you access the <code>NodeInfo</code> of just about any node in the&nbsp;cluster.
Refer to the Javadoc for more&nbsp;information.</p>

<h6 id="api-cluster-info-properties">Custom&nbsp;properties</h6>

<p>Other than its name and id, each node’s configuration record can hold any number of additional properties, which can be&nbsp;accessed
by <code>NodeInfo</code>’s <code>get</code> or <code>getProperties</code>&nbsp;methods.</p>

<p>You can add a custom node property, and additionally require that nodes that have not yet publish a value for the property will not&nbsp;be 
in considered <strong>online</strong> until they do, with the <code>addNodeProperty</code> method (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addNodeProperty(java.lang.String, boolean, boolean, co.paralleluniverse.galaxy.cluster.ReaderWriter)">Javadoc</a>).
Refer to the Javadoc for more&nbsp;information.</p>

<p>The <code>setNodeProperty</code> method lets you set a property of the local&nbsp;node.</p>

<p>The <code>addMasterNodePropertyListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addMasterNodePropertyListener(java.lang.String, co.paralleluniverse.galaxy.cluster.NodePropertyListener)">Javadoc</a>) and <code>addSlaveNodePropertyListener</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addSlaveNodePropertyListener(java.lang.String, co.paralleluniverse.galaxy.cluster.NodePropertyListener)">Javadoc</a>) 
methods allow you to listen for changes in the values of configuration record properties of any master node in the cluster or any of your slave nodes&nbsp;respectively.</p>

<h5 id="api-cluster-tree">The distributed&nbsp;tree</h5>

<p>Galaxy nodes publish their configuration record via a service called <code>DistributedTree</code> (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/DistributedTree.html">Javadoc</a>) which implements a distributed filesystem-like tree of information&nbsp;nodes
(very similar to the way Apache ZooKeeper works, and in fact, when the cluster is configured to use ZooKeeper, the <code>DistributedTree</code> is just a thin layer on top of&nbsp;it).
<code>DistributedTree</code> makes some strong consistency and ordering guarantees about it’s data, which make it suitable for sharing critical configuration data and&nbsp;for
coordination tasks among nodes, such as leader election. Galaxy’s <code>NodeInfo</code> records simply wrap the <code>DistributedTree</code> nodes in one of its branches&nbsp;(directories).</p>

<p>If you’d like direct access to the tree, you can obtain the <code>DistributedTree</code> instance by calling the <code>getDistributedTree</code>&nbsp;method.</p>

<h2 id="config">Configuring and Monitoring&nbsp;Galaxy</h2>

<p>Configuring the Galaxy grid is just as important as using its <span class="caps">API</span>, as the <span class="caps">API</span> is designed to be simple, but the actions Galaxy takes under the hood are very&nbsp;much
determined by the way Galaxy is&nbsp;configured. </p>

<p>Galaxy uses the <a href="http://www.springsource.org/spring-framework">Spring Framework</a> for its configuration, and is configured from an <span class="caps">XML</span> file using Spring Beans. For a short tutorial&nbsp;on
Spring configuration, see <a href="#config-spring">A Spring Primer</a>.</p>

<p class="alert alert-info"><strong>Note</strong>: This manual provides detailed instructions to configuring Galaxy. However, for a quicker start, we suggest you take a look&nbsp;at
<a href="#start-config">Using the pre-built configurations</a> in the Getting Started&nbsp;guide.</p>

<h3 id="config-file">The configuration&nbsp;file(s)</h3>

<p>A Galaxy node is configured from one <span class="caps">XML</span> file (of course, that file can reference others in accordance with the Spring Beans schema), whose path is passed&nbsp;to
the <code>getInstance</code> static method of the <code>Grid</code> class (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Grid.html">Javadoc</a>).
If you pass <code>null</code> (or use the zero-argument version of <code>getInstance</code>), the default configuration file, <code>galaxy.xml</code> is used, if it’s found somewhere on&nbsp;the
classpath.</p>

<p>In addition to the <span class="caps">XML</span> file, you may use a Java properties file, and reference those properties in the configuration file like so: <code>${prop.name}</code>. The&nbsp;name
of the properties file may also be passed to <code>getInstance</code>. If a <code>null</code> name is passed (or the zero-argument version of <code>getInstance</code> is used), no&nbsp;properties
file gets loaded. The properties file is handy when you want to use the same configuration file for all nodes, with only minor differences (like node&nbsp;<span class="caps">ID</span>). 
In this case, you can just set the different properties in the separate properties file. This is the common case so properties files are&nbsp;recommended.</p>

<p>You define properties in the properties file like so (you can make up your own property names - they have no special meaning to&nbsp;Galaxy:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="na">galaxy.nodeId</span><span class="o">=</span><span class="s">3</span>
</span></code></pre></div>
<p>and you reference them from the configuration file when setting configuration properties like&nbsp;this:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;nodeId&quot;</span> <span class="na">value=</span><span class="s">&quot;${galaxy.nodeId}&quot;</span><span class="nt">/&gt;</span> 
</span></code></pre></div>
<p>Alternatively, you can define properties as <span class="caps">JVM</span> system properties by the same&nbsp;name.</p>

<p>The configuration file defines which implementation each Galaxy component is to use, as well as implementation specific configuration parameters for each&nbsp;component.</p>

<p>Galaxy’s configuration is flexible enough to allow running multiple nodes (even server nodes) in the same physical machine. All it requires is setting <span class="caps">IP</span>&nbsp;ports
and the like carefully, where&nbsp;appropriate.</p>

<p class="alert alert-warn"><strong>Note</strong>: You <em>must</em> use the documented bean ids for each component. You may not assign the beans other names, as Galaxy depends on the components having specific&nbsp;names. 
In addition, Spring’s <code>default-autowire</code> mode must be set to&nbsp;<code>constructor</code>.</p>

<p>Here’s how the configuration file should&nbsp;look:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="line-2"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
</span><span id="line-3">       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span id="line-4">       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
</span><span id="line-5">       <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
</span><span id="line-6">
</span><span id="line-7">       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
</span><span id="line-8"><span class="s">          http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
</span><span id="line-9"><span class="s">          http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd&quot;</span>
</span><span id="line-10">       <span class="na">default-lazy-init=</span><span class="s">&quot;false&quot;</span>
</span><span id="line-11">       <span class="na">default-autowire=</span><span class="s">&quot;constructor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-12">
</span><span id="line-13">    <span class="c">&lt;!-- bean definitions ... --&gt;</span>
</span><span id="line-14"><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></div>
<h3 id="config-monitoring">Configuring Galaxy&nbsp;monitoring</h3>

<p>Most Galaxy components expose monitoring data, and most of those that do let you choose what monitor to use (in the <code>monitoringType</code> constructor-arg).&nbsp;Currently,
there are two&nbsp;options:</p>

<ul>
  <li><code>METRICS</code> - uses Yammer’s <a href="http://metrics.codahale.com/">Metrics</a> library. Data can be exported to <span class="caps">JMX</span> MBeans, <a href="http://ganglia.sourceforge.net/">Ganglia</a>, or <a href="http://graphite.wikidot.com/">Graphite</a>. This option gives very detailed an&nbsp;high-resolution
monitoring data, but might be heavy on&nbsp;resources.</li>
  <li><code>JMX</code> - uses simple <span class="caps">JMX</span> MBeans to export monitoring data. The data is lower-resolution and cruder than the Metrics option, but might be lighter on&nbsp;resources.</li>
</ul>

<p>The best way to view MBeans is with <strong>Visual<span class="caps">VM</span></strong>.</p>

<h3 id="config-component-monitor">Monitoring Galaxy’s&nbsp;components</h3>

<p>Most Galaxy components expose monitoring data, and the details about which information is exposed is detailed in the component’s respective manual&nbsp;section.
Aside from component-specific monitoring, all components expose their configuration properties and basic status as MBeans. These MBeans are&nbsp;named
<code>co.paralleluniverse.galaxy:type=components,name=COMPONENT_NAME</code>, where <code>COMPONENT_NAME</code> is the Spring Bean&nbsp;id.</p>

<h3 id="config-logging">Logging</h3>

<p>Galaxy uses <a href="http://www.slf4j.org/"><span class="caps">SLF4J</span></a> for all its&nbsp;logging.</p>

<h3 id="galaxys-components">Galaxy’s&nbsp;components</h3>

<h4 id="config-spring">A Spring&nbsp;Primer</h4>

<p>The <a href="http://www.springsource.org/spring-framework">Spring Framework</a> lets applications configure and wire their components in an <span class="caps">XML</span> file (it does many other things as well, but Galaxy only uses Spring for&nbsp;configuration).
Using Spring or configuration allows very fine-tined control over many aspects of the application, but it can be quite&nbsp;verbose.
This section is a short tutorial explaining how to configure and wire components using Spring&nbsp;<span class="caps">XML.</span> 
For a more detailed reference of Spring configuration please see <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/beans.html">Spring’s IoC Container Documentation</a>.</p>

<h5 id="config-spring-xml">Spring&nbsp;<span class="caps">XML</span></h5>

<p>A Spring configuration file is an <span class="caps">XML</span> file containing bean definitions (beans are explained in the next&nbsp;section).
Here’s the structure of the configuration file, as should be used for Galaxy configuration. It contains some required Spring&nbsp;schemas
as well as a few optional ones that provide some convenient&nbsp;features:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="line-2"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
</span><span id="line-3">       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span id="line-4">       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
</span><span id="line-5">       <span class="na">xmlns:util=</span><span class="s">&quot;http://www.springframework.org/schema/util&quot;</span>
</span><span id="line-6">
</span><span id="line-7">       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
</span><span id="line-8"><span class="s">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
</span><span id="line-9"><span class="s">       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd&quot;</span>
</span><span id="line-10">       <span class="na">default-lazy-init=</span><span class="s">&quot;false&quot;</span>
</span><span id="line-11">       <span class="na">default-autowire=</span><span class="s">&quot;constructor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-12">
</span><span id="line-13">    <span class="c">&lt;!-- bean definitions ... --&gt;</span>
</span><span id="line-14"><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></div>
<h5 id="config-spring-beans">Instantiating&nbsp;beans</h5>

<p>Spring <strong>beans</strong> are application components declared, configured in wired in the Spring <span class="caps">XML</span> configuration file as <code>bean</code> <span class="caps">XML</span>&nbsp;elements. 
Each bean corresponds to an instance of a Java object. A bean has a unique <span class="caps">ID</span>, which names the component, and a means to instantiate&nbsp;it.
Usually, a bean is instantiated by constructing a simple object of a given class, in which case the bean definition would look like&nbsp;this.</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.myClass&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>This would instantiate an instance (called <code>myBean</code>) of the class&nbsp;<code>com.mycompany.myClass</code>.</p>

<p>Sometimes, beans are constructed not using a simple constructor but by calling a factory static method. In that case, the bean&nbsp;definition
would look like&nbsp;this:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.myFactoryClass&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;createInstance&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>This would instantiate a bean (of some unspecified class) by calling the <code>createInstance</code> static method of the <code>com.mycompany.myFactoryClass</code>&nbsp;class.</p>

<h5 id="config-spring-config">Configuring&nbsp;beans</h5>

<p>Usually, a bean definition includes some configuration of the bean&nbsp;instance. 
There are two kinds of configuration hooks: <strong>constructor-args</strong> and <strong>properties</strong>. 
Each bean definition can include constructor-args as well as&nbsp;properties.</p>

<h6 id="constructor-args">constructor-args</h6>

<p><strong>constructor-args</strong> are passed as either constructor arguments to the class constructor or as arguments to the static factory&nbsp;method, 
according to the instantiation mechanism used. They are usually required for a successful bean&nbsp;instantiation.</p>

<p>constructor-args can be passed by name, by index, or by type. Here’s how we use them to instantiate a bean, using&nbsp;names:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.myClass&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;myName&quot;</span> <span class="na">value=</span><span class="s">&quot;foo&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;size&quot;</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>        
</span><span id="line-4"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>Here we’ve passed the value <code>"foo"</code> to the <code>String</code> parameter <code>myName</code> of the constructor, and the value <code>5</code> to the <code>size</code>&nbsp;parameter
(in the next section we’ll see how Spring knows which value type to&nbsp;use).</p>

<p>Unfortunately, specifying constructor-args by name does not always work - it requires either relevant debug information in the class file or&nbsp;the
use of a specific annotation by the class’s author. (Note: all Galaxy components described in this documentation, i.e. those that belong to&nbsp;a
<code>co.paralleluniverse.*</code> packages, are annotated and allow specifying constructor-args by name). If named constructor-args don’t work, we&nbsp;can
specify them using indices like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.myClass&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;foo&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>        
</span><span id="line-4"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>This also passes the String value <code>"foo"</code> as the first argument of the constructor (which is supposedly <code>myName</code>), and&nbsp;the
value <code>5</code> as the second&nbsp;argument.</p>

<p>If each parameter is of a different type, we can also pass constructor-args without specifying either name or index, like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.myClass&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;foo&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>        
</span><span id="line-4"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>This will achieve the same effect, but only if Spring can figure out unambiguously the arguments’ types and which parameter they correspond&nbsp;to;
if not, Spring will issue an&nbsp;error.</p>

<h6 id="properties">properties</h6>

<p><strong>properties</strong> are configurations that are usually optional, and if not included in the bean definition, the bean will use some default&nbsp;values.
Internally, properties are set by calling Java Bean setter methods, and can therefore always be specified by name, like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;otherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.otherClass&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">value=</span><span class="s">&quot;bar&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;colorName&quot;</span> <span class="na">value=</span><span class="s">&quot;blue&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-4">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;width&quot;</span> <span class="na">value=</span><span class="s">&quot;10&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-5">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;height&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-6"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>Of course, some beans combine both constructor-args and&nbsp;properties.</p>

<h5 id="config-spring-p-c">The p- and c-&nbsp;namespaces</h5>

<p>Spring provides two special <span class="caps">XML</span> namespaces called <code>p</code> and <code>c</code> that allow for a less verbose configuration in many&nbsp;cases.</p>

<p>Using the <code>p</code> and <code>c</code> namespaces, you can specify configuration values as <span class="caps">XML</span> attributes rather than as child&nbsp;elements.
So the following definition, using the <code>p</code> and <code>c</code>&nbsp;namespaces:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Foo&quot;</span> <span class="na">c:text=</span><span class="s">&quot;Hello World!&quot;</span> <span class="na">p:height=</span><span class="s">&quot;300&quot;</span> <span class="na">p:color=</span><span class="s">&quot;blue&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></div>
<p>is identical&nbsp;to:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Foo&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;Hello World!&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;height&quot;</span> <span class="na">value=</span><span class="s">&quot;300&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-4">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;color&quot;</span> <span class="na">value=</span><span class="s">&quot;blue&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-5"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>If constructor-arg names do not work with a given class, you can use indices with the <code>c</code> namespace,&nbsp;with</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Bar&quot;</span> <span class="na">c:_0=</span><span class="s">&quot;100&quot;</span> <span class="na">c:_1=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></div>
<p>being the same&nbsp;as</p>

<div class="highlight"><pre><code><span id="line-1">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBean&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Bar&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3">        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-spring-values">Values</h5>

<p>This section explains how Spring interprets property (or constructor-arg)&nbsp;values.</p>

<h6 id="config-spring-values-primitives">Primitives, strings and&nbsp;enums</h6>

<p>Spring uses Java reflection to figure out the type of the property (or constructor-arg), and it attempts to convert the&nbsp;string
value in the <span class="caps">XML</span> document into the appropriate type. So <code>value="5"</code> would become the integer <code>5</code> if the property’s type&nbsp;is
<code>int</code>,  <code>5.0</code> if it’s <code>double</code>, or the string <code>"5"</code> if the property is of type&nbsp;<code>String</code>; 
The values <code>true</code> and <code>false</code> are thus converted to <code>boolean</code> if the property is of the <code>boolean</code>&nbsp;type,
and strings are passed verbatim if the property is of type&nbsp;<code>String</code>.</p>

<p>If a property’s type is a Java enum, then its value is converted to the appropriate enum value according to its&nbsp;name,
so <code>value="NFC"</code> would become <code>java.text.Normalizer.Form.NFC</code> if the property’s type is&nbsp;<code>java.text.Normalizer.Form</code>.</p>

<h6 id="config-spring-values-null">Null&nbsp;values</h6>

<p>If a property (or a constructor-arg), accept a Java reference, then the <code>null</code> value can be passed like&nbsp;this:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span><span class="nt">&gt;&lt;null/&gt;&lt;/property&gt;</span>
</span></code></pre></div>
<h6 id="config-spring-values-ref">Referencing other&nbsp;beans</h6>

<p>When a property (or constructor-arg) take an object, we can pass it one of the beans we’ve&nbsp;defined.
So, if we have this&nbsp;bean:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;fooBean&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Foo&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></div>
<p>and the <code>Bar</code> class has a property (or constructor-arg) taking a <code>Foo</code>, we can pass it <code>fooBean</code> like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myBar&quot;</span> <span class="na">class=</span><span class="s">&quot;a.b.Bar&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">ref=</span><span class="s">&quot;fooBean&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>Notice the use of the <code>ref</code> attribute rather than&nbsp;<code>value</code>.</p>

<p>The same could be done with the c/p- namespaces: <code>p:foo-ref="myFoo"</code>, <code>c:foo-ref="myFoo"</code> or&nbsp;<code>c:_0-ref="myFoo"</code>.</p>

<h6 id="config-spring-values-inner">Compound values (inner&nbsp;beans)</h6>

<p>When a property (or a constructor-arg) take an object, we could use a <code>ref</code>, but if the object is to be used only&nbsp;for
the purpose of setting this particular property, rather than define a new bean and reference it, it is less&nbsp;verbose,
less cluttered, and generally preferable to use an “inner&nbsp;bean”. </p>

<p>Inner beans are bean definitions local to a single property (or constructor arg), that don’t have an <code>id</code>, and&nbsp;therefore
cannot be referenced anywhere&nbsp;else.</p>

<p>Here’s an example from a Galaxy configuration file of setting a property that takes a value of type&nbsp;<code>java.net.InetSocketAddress</code>:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;multicastGroup&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;java.net.InetSocketAddress&quot;</span><span class="nt">&gt;</span>
</span><span id="line-3">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;225.0.0.1&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;7050&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-6"><span class="nt">&lt;/property&gt;</span>
</span></code></pre></div>
<p>Or, more&nbsp;succinctly:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;multicastGroup&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;java.net.InetSocketAddress&quot;</span> <span class="na">c:_0=</span><span class="s">&quot;225.0.0.1&quot;</span> <span class="na">c:_1=</span><span class="s">&quot;7050&quot;</span> <span class="nt">/&gt;</span>
</span><span id="line-3"><span class="nt">&lt;/property&gt;</span>
</span></code></pre></div>
<h4 id="config-cluster">Configuring the Cluster&nbsp;Component</h4>

<p>The cluster component (defined by the Spring Bean named <code>cluster</code>) is the most fundamental of Galaxy’s&nbsp;components. 
It defines how the Galaxy nodes discover each other and exchange configuration&nbsp;data.</p>

<p>There are currently two implementations of the cluster, one employing Apache ZooKeeper, and the other using JGroups. You may choose whichever you prefer.&nbsp;Note,
however, that ZooKeeper requires special server nodes while JGroups&nbsp;doesn’t.</p>

<h5 id="config-cluster-common">Servers and Backup&nbsp;Groups</h5>

<p>Both <code>cluster</code> implementations share a couple of&nbsp;properties. </p>

<p>The first sets the <code>nodeId</code> (constructor-arg, <code>short</code>). This is a required property.<br />
The special node id of <code>0</code> is reserved for server nodes (see&nbsp;below).</p>

<p>The other common property is <code>hasServer</code> (property, <code>boolean</code>,&nbsp;default:<code>true</code>). 
It is an optional property (with the default value <code>true</code>) that specifies whether the cluster&nbsp;has
server&nbsp;nodes.</p>

<p>There are two mechanisms by which Galaxy provides high-availability in the face of node failures: server nodes and backup&nbsp;groups.</p>

<h6 id="config-cluster-organization-server">Server&nbsp;node</h6>

<p>A server node (or nodes) is a special Galaxy node that doesn’t run application code, but is responsible for providing Galaxy&nbsp;data
with disk-based persistence. All of the data in the grid is persisted to disk on the server node, and is also automatically&nbsp;served
by it in case of a node&nbsp;failure. </p>

<p>The node server always has a node id of <code>0</code>, and, just like with regular nodes, you can have several server nodes in&nbsp;a 
backup group (see below) configuration for added&nbsp;availability.</p>

<p>See <a href="#config-server">Configuring, Running and Monitoring the Server</a> for more information about configuring and running server&nbsp;node(s).</p>

<h6 id="config-cluster-organization-backup">Backup&nbsp;Groups</h6>

<p>Galaxy nodes can be configured in backup groups. All nodes assigned the same node id in their configuration file will become&nbsp;part 
of the same backup group. At any given time, each live backup group has exactly one <strong>master</strong> node, and zero or more <strong>slave</strong>
nodes. The master node replicates all of its owned data items to its slaves so that they can take over in case it&nbsp;fails.</p>

<p>When the master node fails, one of its slaves will become the master and take over. However, a master node <em>can never become a slave</em>.
A slave node is notified of its new master status by an event (see <a href="#api-cluster-lifecycle">Lifecycle events</a>).</p>

<p>See <a href="#api-cluster-organization">Cluster organization</a> for more&nbsp;information.</p>

<p class="alert alert-warn"><strong>Note</strong>: This version of Galaxy does not yet support a backup group for the server. This version of Galaxy supports backup groups of size 2 only (i.e. one master and one backup for each peer&nbsp;node). </p>

<h6 id="config-cluster-organization-serverless">Should you use a&nbsp;server?</h6>

<p>Short answer: <strong>yes!</strong></p>

<p>While you can configure a Galaxy cluster without a server, such configuration entails a somewhat different cache-coherence&nbsp;protocol.
When not using a server node, if two node failures occur (from two different backup groups) within a very short time&nbsp;period, 
this may result in lost data items (though not in data&nbsp;conflicts). </p>

<p>In addition, it is not yet clear how dependable the grid could be without a server, and how useful a server-less configuration&nbsp;is.
It is possible that the server-less configuration will be discontinued in a future&nbsp;version.</p>

<p class="alert alert-warn"><strong>Note</strong>: In this version, the server-less configuration is not dependable, and may result in lost data, and possibly data&nbsp;conflicts,
even if <em>a single node&nbsp;fails!</em></p>

<h5 id="config-cluster-zookeeper">Using&nbsp;ZooKeeper</h5>

<p>The <code>cluster</code> component can use <a href="http://zookeeper.apache.org/">Apache ZooKeeper</a> for cluster management. Galaxy uses ZooKeeper through the Netflix’s <a href="https://github.com/Netflix/curator">Curator</a>&nbsp;library
which simplifies ZooKeeper use. Please refer to the ZooKeeper documentation on how to set up ZooKeeper&nbsp;servers.</p>

<p>The ZooKeeper implementation of the <code>cluster</code> component is called&nbsp;<code>co.paralleluniverse.galaxy.zookeeper.ZooKeeperCluster</code>
and has (in addition to the common <code>nodeId</code> and <code>hasServer</code>) the following configuration&nbsp;properties:</p>

<p><code>zkConnectString</code> (constructor-arg, <code>String</code>) <br />
  The ZooKeeper connection string, which tells the node how to connect to the ZooKeeper servers. See the <a href="http://zookeeper.apache.org/doc/trunk/zookeeperProgrammers.html">ZooKeeper Programmers Guide</a> for&nbsp;details.</p>

<p><code>sessionTimeoutMs</code> (property, <code>int</code>, default: <code>15000</code>) <br />
  The ZooKeeper session timeout, in milliseconds. The ZooKeeper documentation has the&nbsp;details.</p>

<p><code>connectionTimeoutMs</code> (property, <code>int</code>, default: <code>10000</code>) <br />
  The Curator connection timeout, in&nbsp;milliseconds.</p>

<p><code>retryPolicy</code> (property, <code>com.netflix.curator.retry.ExponentialBackoffRetry</code>, default: <code>new ExponentialBackoffRetry(20, 20)</code>) <br />
  The Curator retry policy for failed ZooKeeper operations. See the example below on how to set this&nbsp;property.
  Refer to the <a href="https://github.com/Netflix/curator/wiki">Curator documentation</a> for&nbsp;details.</p>

<h6 id="using-zookeeper-in-the-cloud">Using ZooKeeper in the&nbsp;Cloud</h6>

<p>There generally shouldn’t be a problem running Galaxy with ZooKeeper in the cloud. However, using ZooKeeper requires that&nbsp;the
<span class="caps">UDP</span> implementation of the <code>comm</code> component be used, and that should be configured correctly to work in cloud&nbsp;environments.
Please refer to <a href="#config-comm-common-cloud">No multicast (using Galaxy in the cloud)</a> for&nbsp;information.</p>

<h6 id="zookeeper-configuration-example">ZooKeeper Configuration&nbsp;Example</h6>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cluster&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.zookeeper.ZooKeeperCluster&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;nodeId&quot;</span> <span class="na">value=</span><span class="s">&quot;${galaxy.nodeId}&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hasServer&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;zkConnectString&quot;</span> <span class="na">value=</span><span class="s">&quot;127.0.0.1:2181&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sessionTimeoutMs&quot;</span> <span class="na">value=</span><span class="s">&quot;1500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;connectionTimeoutMs&quot;</span> <span class="na">value=</span><span class="s">&quot;1000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;retryPolicy&quot;</span><span class="nt">&gt;</span>
</span><span id="line-8">          <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.netflix.curator.retry.ExponentialBackoffRetry&quot;</span><span class="nt">&gt;</span>
</span><span id="line-9">              <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;20&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-10">              <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;20&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-11">          <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-12">      <span class="nt">&lt;/property&gt;</span>
</span><span id="line-13"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-cluster-jgroups">Using&nbsp;JGroups</h5>

<p>Instead of ZooKeeper, the <code>cluster</code> component can used an implementation (called&nbsp;<code>co.paralleluniverse.galaxy.jgroups.JGroupsCluster</code>) 
that employs <a href="http://www.jgroups.org/">JGroups</a> for cluster management. Unlike ZooKeeper, JGroups manages the cluster in a purely peer-to-peer fashion, and&nbsp;thus
does not require any special&nbsp;servers.</p>

<p>In addition to <code>nodeId</code> and <code>hasServer</code>, the JGroups <code>cluster</code> bean requires a few more properties, both must be identical in&nbsp;all 
Galaxy&nbsp;nodes.</p>

<p>The first, <code>jgroupsClusterName</code> (constructor-arg, <code>String</code>), is a <code>String</code> identifier you choose to give the JGroups&nbsp;cluster. 
This property must be identical in all of the cluster&nbsp;nodes.</p>

<p>The second is contains the detailed JGroups cluster configuration, and this property, too, must be identical in all&nbsp;nodes.</p>

<p>There are two options for setting&nbsp;it. 
You can either set the <code>jgroupsConfXML</code> property to point to a JGroups <span class="caps">XML</span> configuration&nbsp;file,
or set the <code>jgroupsConf</code> property and embed within it the JGroups <span class="caps">XML</span> configuration, as in the example&nbsp;below.
You must set one of these properties, but not&nbsp;both.</p>

<p><a href="http://www.jgroups.org/manual-3.x/html/user-advanced.html#d0e2199">This section</a> of the JGroups manual explains the JGroups configuration in detail, but the JGroups jar file contains several&nbsp;complete
<span class="caps">XML</span> configuration files you can use as a&nbsp;basis.</p>

<p>Any valid JGroups configuration would do, but you must make two important addition to ensure proper operation of Galaxy (either in the&nbsp;embedded
configuration or in the separate <span class="caps">XML</span>&nbsp;file).</p>

<p>First, you must add the <a href="http://www.jgroups.org/manual-3.x/html/protlist.html#SEQUENCER"><span class="caps">SEQUENCER</span></a> protocol to the&nbsp;configuration, 
so that a complete ordering of configuration messages is enforced. This is done by adding the following <span class="caps">XML</span> element to the JGroups&nbsp;configuration,
somewhere towards the&nbsp;bottom:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;SEQUENCER</span> <span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Second, you must add the <a href="http://www.jgroups.org/manual-3.x/html/protlist.html#COUNTER"><span class="caps">COUNTER</span></a>&nbsp;protocol.
Add the following <span class="caps">XML</span> element at the very bottom of the JGroups&nbsp;configuration:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;COUNTER</span> <span class="na">bypass_bundling=</span><span class="s">&quot;true&quot;</span>  <span class="na">timeout=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Third, if the cluster is configured not to use a server (<code>hasServer</code> is set to <code>false</code>), a locking protocol must be&nbsp;added
to the bottom of JGroups&nbsp;configuration:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;CENTRAL_LOCK</span> <span class="na">num_backups=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p class="alert alert-warn"><strong>Note</strong>:
Do not forget to add the <code>SEQUENCER</code> and <code>COUNTER</code> (and if no server is used then <code>CENTRAL_LOCK</code> as&nbsp;well) 
protocols to the JGroups&nbsp;configuration!</p>

<p>The third property, <code>jgroupsThreadPool</code> (property, <code>java.util.concurrent.ThreadPoolExecutor</code>, required), creates the thread pool used&nbsp;by 
JGroups. Please refer to <a href="#config-misc-threadpool">Thread pools</a> to learn how to configure thread-pools, or look at the example&nbsp;below.</p>

<h6 id="config-cluster-jgroups-cloud">Using JGroups in the&nbsp;Cloud</h6>

<p>Some cloud environments (like Amazon <span class="caps">EC2</span>) prohibit multicast, so JGroups must be configured to not use&nbsp;multicast
if you’re running Galaxy in such an&nbsp;environment.</p>

<p>There are generally two options to use in such cases. The first is to use the <a href="http://www.jgroups.org/manual-3.x/html/protlist.html#UDP"><span class="caps">UDP</span></a>
JGroups transport, but disable multicasting (by setting to <code>false</code> the <code>ip_mcast</code> property). In addition, you must use a discovery&nbsp;protocol
that does not employ multicasting, such as <code>FILE_PING</code>, <code>JDBC_PING</code>, <code>RACKSPACE_PING</code> or&nbsp;<code>S3_PING</code>. 
See <a href="http://www.jgroups.org/manual-3.x/html/protlist.html#DiscoveryProtocols">Initial membership discovery</a> in the JGroups&nbsp;documentation
for more information on discovery&nbsp;protocols.</p>

<p>The other option is to use the <a href="http://www.jgroups.org/manual-3.x/html/protlist.html#TCP"><span class="caps">TCP</span></a> JGroups transport with either&nbsp;the 
<code>TCPPING</code> or <code>TCPGOSSIP</code> discovery protocols (or any of the ones mentioned&nbsp;above).</p>

<p class="alert alert-info"><strong>Note</strong>:
When using Galaxy and JGroups in environments that do not support multicasting, you must also configure the <code>comm</code> component&nbsp;appropriately.
See <a href="#config-comm-common-cloud">No multicast (using Galaxy in the cloud)</a>.</p>

<h6 id="jgroups-configuration-example">JGroups Configuration&nbsp;Example</h6>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cluster&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.jgroups.JGroupsCluster&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;nodeId&quot;</span> <span class="na">value=</span><span class="s">&quot;${galaxy.nodeId}&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hasServer&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;jgroupsClusterName&quot;</span> <span class="na">value=</span><span class="s">&quot;cluster1&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jgroupsConf&quot;</span><span class="nt">&gt;</span>
</span><span id="line-6">      <span class="nt">&lt;value&gt;</span>
</span><span id="line-7">        <span class="cp">&lt;![CDATA[</span>
</span><span id="line-8"><span class="cp">        &lt;config xmlns=&quot;urn:org:jgroups&quot;</span>
</span><span id="line-9"><span class="cp">                xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span id="line-10"><span class="cp">                xsi:schemaLocation=&quot;urn:org:jgroups http://www.jgroups.org/schema/JGroups-3.1.xsd&quot;&gt;</span>
</span><span id="line-11"><span class="cp">            &lt;UDP</span>
</span><span id="line-12"><span class="cp">                mcast_port=&quot;${jgroups.udp.mcast_port:45588}&quot;</span>
</span><span id="line-13"><span class="cp">                tos=&quot;8&quot;</span>
</span><span id="line-14"><span class="cp">                ucast_recv_buf_size=&quot;20M&quot;</span>
</span><span id="line-15"><span class="cp">                ucast_send_buf_size=&quot;640K&quot;</span>
</span><span id="line-16"><span class="cp">                mcast_recv_buf_size=&quot;25M&quot;</span>
</span><span id="line-17"><span class="cp">                mcast_send_buf_size=&quot;640K&quot;</span>
</span><span id="line-18"><span class="cp">                loopback=&quot;true&quot;</span>
</span><span id="line-19"><span class="cp">                discard_incompatible_packets=&quot;true&quot;</span>
</span><span id="line-20"><span class="cp">                max_bundle_size=&quot;64K&quot;</span>
</span><span id="line-21"><span class="cp">                max_bundle_timeout=&quot;30&quot;</span>
</span><span id="line-22"><span class="cp">                ip_ttl=&quot;${jgroups.udp.ip_ttl:8}&quot;</span>
</span><span id="line-23"><span class="cp">                enable_bundling=&quot;true&quot;</span>
</span><span id="line-24"><span class="cp">                enable_diagnostics=&quot;true&quot;</span>
</span><span id="line-25"><span class="cp">                thread_naming_pattern=&quot;cl&quot;</span>
</span><span id="line-26">
</span><span id="line-27"><span class="cp">                timer_type=&quot;new&quot;</span>
</span><span id="line-28"><span class="cp">                timer.min_threads=&quot;4&quot;</span>
</span><span id="line-29"><span class="cp">                timer.max_threads=&quot;10&quot;</span>
</span><span id="line-30"><span class="cp">                timer.keep_alive_time=&quot;3000&quot;</span>
</span><span id="line-31"><span class="cp">                timer.queue_max_size=&quot;500&quot;/&gt;</span>
</span><span id="line-32">
</span><span id="line-33"><span class="cp">            &lt;PING timeout=&quot;2000&quot;</span>
</span><span id="line-34"><span class="cp">                  num_initial_members=&quot;4&quot;/&gt;</span>
</span><span id="line-35"><span class="cp">            &lt;MERGE3 max_interval=&quot;30000&quot;</span>
</span><span id="line-36"><span class="cp">                    min_interval=&quot;10000&quot;/&gt;</span>
</span><span id="line-37"><span class="cp">            &lt;FD_SOCK/&gt;</span>
</span><span id="line-38"><span class="cp">            &lt;FD_ALL/&gt;</span>
</span><span id="line-39"><span class="cp">            &lt;VERIFY_SUSPECT timeout=&quot;1500&quot;  /&gt;</span>
</span><span id="line-40"><span class="cp">            &lt;BARRIER /&gt;</span>
</span><span id="line-41"><span class="cp">            &lt;pbcast.NAKACK2 xmit_interval=&quot;1000&quot;</span>
</span><span id="line-42"><span class="cp">                            xmit_table_num_rows=&quot;100&quot;</span>
</span><span id="line-43"><span class="cp">                            xmit_table_msgs_per_row=&quot;2000&quot;</span>
</span><span id="line-44"><span class="cp">                            xmit_table_max_compaction_time=&quot;30000&quot;</span>
</span><span id="line-45"><span class="cp">                            max_msg_batch_size=&quot;500&quot;</span>
</span><span id="line-46"><span class="cp">                            use_mcast_xmit=&quot;false&quot;</span>
</span><span id="line-47"><span class="cp">                            discard_delivered_msgs=&quot;true&quot;/&gt;</span>
</span><span id="line-48"><span class="cp">            &lt;UNICAST /&gt;</span>
</span><span id="line-49"><span class="cp">            &lt;pbcast.STABLE stability_delay=&quot;1000&quot; desired_avg_gossip=&quot;50000&quot;</span>
</span><span id="line-50"><span class="cp">                           max_bytes=&quot;4M&quot;/&gt;</span>
</span><span id="line-51"><span class="cp">            &lt;pbcast.GMS print_local_addr=&quot;true&quot; join_timeout=&quot;3000&quot;</span>
</span><span id="line-52"><span class="cp">                        view_bundling=&quot;true&quot;/&gt;</span>
</span><span id="line-53"><span class="cp">            &lt;SEQUENCER /&gt;</span>
</span><span id="line-54"><span class="cp">            &lt;UFC max_credits=&quot;2M&quot;</span>
</span><span id="line-55"><span class="cp">                 min_threshold=&quot;0.4&quot;/&gt;</span>
</span><span id="line-56"><span class="cp">            &lt;MFC max_credits=&quot;2M&quot;</span>
</span><span id="line-57"><span class="cp">                 min_threshold=&quot;0.4&quot;/&gt;</span>
</span><span id="line-58"><span class="cp">            &lt;FRAG2 frag_size=&quot;60K&quot;  /&gt;</span>
</span><span id="line-59"><span class="cp">            &lt;pbcast.STATE_TRANSFER /&gt;</span>
</span><span id="line-60"><span class="cp">            &lt;COUNTER bypass_bundling=&quot;true&quot; </span>
</span><span id="line-61"><span class="cp">                     timeout=&quot;5000&quot;/&gt;</span>
</span><span id="line-62"><span class="cp">        &lt;/config&gt;</span>
</span><span id="line-63"><span class="cp">        ]]&gt;</span>
</span><span id="line-64">      <span class="nt">&lt;/value&gt;</span>
</span><span id="line-65">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-66">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jgroupsThreadPool&quot;</span><span class="nt">&gt;</span>
</span><span id="line-67">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.ConfigurableThreadPool&quot;</span><span class="nt">&gt;</span>
</span><span id="line-68">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;corePoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-69">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-70">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;keepAliveMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-71">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-72">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-73">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-74"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h4 id="config-cache">Configuring and Monitoring the&nbsp;Cache</h4>

<p>The cache (bean id <code>cache</code>) is the component responsible for the managements of data items in the local node’s <span class="caps">RAM</span>, and&nbsp;for
the ownership cache-coherence&nbsp;logic.</p>

<h5 id="config-cache-1">Configuring the&nbsp;cache</h5>

<p>The cache currently has only one implementation (<code>co.paralleluniverse.galaxy.core.Cache</code>), and the following&nbsp;properties:</p>

<p><code>monitoringType</code> (constructor-arg, <code>String</code>) <br />
  Sets the monitor type to use for cache monitoring. Can be either <code>METRICS</code> or <code>JMX</code> (see <a href="#config-monitoring">Configuring Galaxy monitoring</a>).</p>

<p><code>synchronous</code> (property, <code>boolean</code>, default: <code>false</code>) <br />
  Whether or not backups are done&nbsp;synchronously.
  When set to <code>true</code>, local get operations block until the server and/or slaves have acknowledged the&nbsp;backup.</p>

<p><code>maxCapacity</code> (constructor-arg, <code>long</code>) <br />
  The maximum capacity (in bytes) to be used for storing shared items. If shared items take up more space than that, they will be evicted from the&nbsp;cache.
  Note that owned items are never&nbsp;evicted. </p>

<p><code>maxItemSize</code> (property, <code>int</code>, default: <code>1024</code>) <br />
  The maximum size, in bytes of a single data item. If <code>UDPComm</code> is used as the <code>comm</code> implementation (see <a href="#config-comm">Configuring and Monitoring the Comm Component</a>), then an item must fit in a single <span class="caps">UDP</span> packet with room to spare. Ideally, it would fit in one <span class="caps">IP</span> packet, so for larger values of <code>maxItemSize</code> it’s best to configure your network to use jumbo packets. This value must be the same in all&nbsp;nodes.</p>

<p><code>rollbackSupported</code> (property, <code>boolean</code>, default: <code>true</code>) <br />
  Sets whether or not automatic rollbacks for transactions are supported. See <a href="#api-store-transactions">Transactions</a> and the&nbsp;<code>Store.rollback()</code> 
  (<a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Store.html#rollback(co.paralleluniverse.galaxy.StoreTransaction)">Javadoc</a>).</p>

<p><code>compareBeforeWrite</code> (property, <code>boolean</code>, default: <code>true</code>) <br />
  Sets whether or not written items should first be compared with their old value before creating a new version (Galaxy maintains a version number for each&nbsp;item
  to track&nbsp;updates).</p>

<p><code>reuseLines</code> (property, <code>boolean</code>, default: <code>true</code>) <br />
  Sets whether or not the cache should pool and reuse the data-item book-keeping&nbsp;objects.</p>

<p><code>reuseSharerSets</code> (property, <code>boolean</code>, default: <code>false</code>) <br />
  Sets whether or not the cache should pool and reuse the objects used to store data-item&nbsp;sharers.</p>

<p><code>maxStaleReadMillis</code> (property, <code>long</code>, default: <code>500</code>) <br />
  The maximum amount of time (in milliseconds) allowed to elapse since an item has been invalidated while still allowing the <strong>get</strong>&nbsp;operation
  to return the old value. Note that if a <strong>get</strong> could result in any inconsistency, the fresh value will always be retrieved from the&nbsp;owning 
  node no matter what the value of this property&nbsp;is.</p>

<p>Here’s an&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cache&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.Cache&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxCapacity&quot;</span> <span class="na">value=</span><span class="s">&quot;100000000&quot;</span><span class="nt">/&gt;</span> 
</span><span id="line-4">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxItemSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;reuseLines&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;reuseSharerSets&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rollbackSupported&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-8">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;compareBeforeWrite&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-9"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p class="alert alert-info"><strong>Note</strong>: Synchronous mode is not yet implemented in this&nbsp;version.</p>

<h5 id="config-cache-storage">Configuring local&nbsp;storage</h5>

<p><code>localStorage</code> is a component related to <code>cache</code>. It is responsible for the actual storage in <span class="caps">RAM</span> of the data&nbsp;items.
There are currently two implementations - one keeps the items in the Java heap, and one stores them in direct <code>ByteBuffer</code>&nbsp;s.</p>

<h6 id="heap-local-storage">Heap local&nbsp;storage</h6>

<p>The <code>co.paralleluniverse.galaxy.HeapLocalStorage</code> implementation stores items in plain Java byte-arrays, allowing the Java&nbsp;garbage-collector
to reclaim them when&nbsp;appropriate.</p>

<p>It has one property - <code>monitoringType</code> (constructor-arg, <code>String</code>), which you can set to either <code>METRICS</code> or <code>JMX</code> (see <a href="#config-monitoring">Configuring Galaxy monitoring</a>).</p>

<p>This is how you configure&nbsp;it:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;localStorage&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.HeapLocalStorage&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h6 id="off-heap-local-storage">Off-heap local&nbsp;storage</h6>

<p>The other <code>localStorage</code> implementation, <code>co.paralleluniverse.galaxy.core.OffHeapLocalStorage</code>, stores data items in direct <code>ByteBuffer</code> s and&nbsp;manages
allocations and de-allocations. It manages blocks of fixed-sized memory pages, each block used for data items of certain sizes. When allocating memory&nbsp;for
an item of sized <code>n</code>, the memory buffer returned will be the nearest power-of-two greater-or-equal to&nbsp;<code>n</code>.</p>

<p>It has several configuration&nbsp;properties:</p>

<p><code>monitoringType</code> (constructor-arg, <code>String</code>) <br />
  Can be <code>METRICS</code> or <code>JMX</code> (see <a href="#config-monitoring">Configuring Galaxy monitoring</a>).</p>

<p><code>pageSize</code> (constructor-arg, <code>int</code>) <br />
  The size <strong>in kilobytes</strong> of each memory page used by the&nbsp;allocator.</p>

<p><code>maxItemSize</code> (constructor-arg, <code>int</code>) <br />
  The maximum size, in bytes of a single data item. Must be set to the same value as the <code>maxItemSize</code> property of the <code>cache</code>&nbsp;component.</p>

<p><code>maxPagesForConcurrency</code> (property, <code>int</code>, default: <code>Runtime.getRuntime().availableProcessors() * 2</code>) <br />
  The maximum number of pages to allocate in each block simply for reducing contention (and not because memory is&nbsp;exhausted).</p>

<p>Here’s an&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;localStorage&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.OffHeapLocalStorage&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    	<span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span> 
</span><span id="line-3">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;pageSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxItemSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxPagesForConcurrency&quot;</span> <span class="na">value=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>The amount of memory available for direct buffer is determined by the <code>XX:MaxDirectMemorySize</code> command line option passed to the&nbsp;<span class="caps">JVM</span>
(the <code>java</code> command). For example, to provide <span class="caps">512MB</span> to direct ByteBuffers, you add the following command line option to the <code>java</code>&nbsp;command:</p>

<div class="highlight"><pre><code><span id="line-1">-XX:MaxDirectMemorySize<span class="o">=</span>100M
</span></code></pre></div>
<h5 id="config-cache-backup">Configuring&nbsp;Backup</h5>

<p>The <code>backup</code> component is responsible for backing up the node’s owned items after modifications to the server and/or&nbsp;slaves.
There is currently one implementation of <code>backup</code> - <code>co.paralleluniverse.galaxy.core.BackupImpl"</code> - and it has two configuration&nbsp;properties:</p>

<p><code>monitoringType</code> (constructor-arg, <code>String</code>) <br />
  Sets the monitor type to use for cache monitoring. Can be either <code>METRICS</code> or <code>JMX</code> (see <a href="#config-monitoring">Configuring Galaxy monitoring</a>).</p>

<p><code>maxDelay</code> (property, <code>int</code>, default: <code>10</code>) <br />
  The maximum duration, <em>in milliseconds</em>, between flushes of backup data (to the server and/or slaves.) It is also roughly the maximum amount of&nbsp;time
  that can be “lost”, i.e. updates that can disappear if the node goes down. If it’s small, less updates can be lost in a case of failure, but&nbsp;both
  latency and throughput would&nbsp;suffer.</p>

<p><code>serverComm</code> (constructor-arg, <code>co.paralleluniverse.galaxy.core.ServerComm</code>, default: autowired) <br />
  If you configure your cluster without a server, set this constructor-arg to <code>null</code>(see <a href="#config-spring-values-null">Null values</a>).&nbsp;Otherwise,
  don’t set it at all, and Spring will auto-wire it to whatever <code>serverComm</code> component you have defined (see <a href="#config-comm-common-servercomm">The ServerComm</a>).</p>

<p>Here’s a configuration&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;backup&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.BackupImpl&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">      <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxDelay&quot;</span> <span class="na">value=</span><span class="s">&quot;200&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-cache-monitoring">Monitoring the&nbsp;cache</h5>

<p><span class="caps">TBD</span></p>

<h4 id="config-messenger">Configuring and Monitoring the&nbsp;Messenger</h4>

<p>The Messenger component (bean: <code>messenger</code>) is responsible for sending and receiving user messages on the&nbsp;grid
(see <a href="#api-messenger">Messenger</a>).</p>

<h5 id="config-messenger-config">Configuring the&nbsp;messenger</h5>

<p><code>messenger</code> has only one implementation - <code>co.paralleluniverse.galaxy.core.MessengerImpl</code>, and it takes just one configuration&nbsp;property:
<code>threadPool</code> (property, <code>co.paralleluniverse.galaxy.core.NodeOrderedThreadPoolExecutor</code>, required).&nbsp;<code>NodeOrderedThreadPoolExecutor</code>
is a special king of <code>java.util.concurrent.ThreadPoolExecutor</code>, and to learn more about configuring it, please see <a href="#config-misc-threadpool">Thread&nbsp;pools</a>
for instructions on how to configure a thread-pool, or just take a look at this&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;messenger&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.MessengerImpl&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;threadPool&quot;</span><span class="nt">&gt;</span>
</span><span id="line-3">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.NodeOrderedThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-4">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;corePoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maximumPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;keepAliveTime&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;unit&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-8">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-9">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;workQueue&quot;</span><span class="nt">&gt;</span>
</span><span id="line-10">                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.common.concurrent.SimpleBlockingQueue&quot;</span> <span class="na">c:maxSize=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-11">            <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-12">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-13">    <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-14"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h4 id="config-comm">Configuring and Monitoring the Comm&nbsp;Component</h4>

<p>The Comm component (bean id: <code>comm</code>) is responsible for transmitting Galaxy’s internal cache-coherence protocol messages, as well as user&nbsp;messages
(sent with the <code>Messenger</code>) over the network. There are currently two implementations for this component. The first uses <span class="caps">UDP</span>, and the second&nbsp;uses 
JGroups and is available only if the cluster is configured to use JGroups (see <a href="#config-cluster-jgroups">Using JGroups</a>).</p>

<h5 id="config-comm-common">Common comm&nbsp;configurations</h5>

<p>Both <code>comm</code> implementations share a couple of very important configuration&nbsp;properties.</p>

<h6 id="config-comm-common-timeout">Timeout</h6>

<p>The <code>timeout</code> configuration (property, <code>long</code>, default: <code>200</code>), is the duration, <strong>in milliseconds</strong> to wait for a response to&nbsp;a 
massage. This, in effect, determines the time it takes for any grid operation to fail and throw a <code>TimeoutException</code> (See <a href="#api-store-ownership-deadlock">Deadlocks</a> and <a href="#api-store-transactions">Transactions</a>).</p>

<p>The shorter the timeout is, the faster deadlocks will be detected, but so will more operations fail spuriously due to network&nbsp;latency.</p>

<h6 id="config-comm-common-cloud">No multicast (using Galaxy in the&nbsp;cloud)</h6>

<p>For some internal operations (such as finding the owner of a freshly-encountered item id), both Comm implementations use multicast by&nbsp;default.
Some cloud platforms (like Amazon <span class="caps">EC2</span>) do not allow multicast, so to run Galaxy without multicast, we can configure it to use the server&nbsp;for
node discovery. Of course, in a situation like that a server is&nbsp;necessary.</p>

<p>In deployments where multicast is available, communicating with the server instead of multicasting can have a performance impact - sometimes for the&nbsp;better
and sometimes for the worse, depending mostly on your server’s&nbsp;performance.</p>

<p>To tell <code>comm</code> to talk to the server instead of multicasting, set the bean property <code>sendToServerInsteadOfMulticast</code> to <code>true</code> (it’s <code>false</code> by&nbsp;default).</p>

<p>Please not that if you’re using JGroups for your <code>cluster</code> component implementation, you must configure JGroups to avoid multicast as&nbsp;well. 
See <a href="#config-cluster-jgroups-cloud">Using JGroups in the Cloud</a> for more&nbsp;information.</p>

<h6 id="config-comm-common-servercomm">The&nbsp;ServerComm</h6>

<p><code>comm</code> makes use of another component, called <code>serverComm</code> to communicate with the server. At the moment, there is just one implementation of&nbsp;<code>server-comm</code>,
which uses <span class="caps">TCP</span> (so it makes use of the optional <code>bossExecutor</code>, <code>workerExecutor</code> and <code>receiveExecutor</code>&nbsp;properties,
explained in <a href="#config-comm-netty">Configuring Netty Channels</a>. </p>

<p>So, if your cluster has a server node, define it with the following bean (in this example we do not set the thread-pool properties, so defaults are&nbsp;used):</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;serverComm&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.netty.TcpServerClientComm&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>and link it to the <code>comm</code> bean by putting this line in the <code>comm</code> bean&nbsp;definition:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;serverComm&quot;</span> <span class="na">ref=</span><span class="s">&quot;serverComm&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>(Actually, there is one more <code>server-comm</code> implementation, one that’s used with something called “dumb servers”. See <a href="#config-server-dumb">Dumb servers</a> for&nbsp;details).</p>

<p>If your cluster is configured without a server, set this constructor-arg to <code>null</code> (see <a href="#config-spring-values-null">Null values</a>). </p>

<h6 id="config-comm-common-slavecomm">The&nbsp;SlaveComm</h6>

<p>Just like a special component is used to communicate with the server, so too a special component is used to communicate with the slaves in the node’s backup&nbsp;group.
The component is <code>slaveComm</code>, and it currently has one implementation that uses <span class="caps">TCP</span> called&nbsp;<code>co.paralleluniverse.galaxy.netty.TcpSlaveComm</code>. </p>

<p>In addition to the optional <code>bossExecutor</code>, <code>workerExecutor</code> and <code>receiveExecutor</code> properties explained <a href="#config-comm-netty">Configuring Netty Channels</a>,
it has one configuration&nbsp;property:</p>

<p><code>port</code> (constructor-arg, <code>int</code>) <br />
  The <span class="caps">TCP</span> port used for master-slave communications. The master binds a server socket to this port (and the slaves discover the port using the&nbsp;distributed 
  configuration record, so in principle, this port can be different on each node, as it’s used only when the node is&nbsp;master.)</p>

<p>Here’s an&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;slaveComm&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.netty.TcpSlaveComm&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span> <span class="na">value=</span><span class="s">&quot;${grid.slave_port}&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;receiveExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-4">      <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-5">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;corePoolSize&quot; --&gt;</span>
</span><span id="line-6">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxChannelMemorySize&quot; --&gt;</span>
</span><span id="line-7">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxTotalMemorySize&quot; --&gt;</span>
</span><span id="line-8">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;3&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;keepAliveTime&quot; --&gt;</span>
</span><span id="line-9">          <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;4&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;unit&quot; --&gt;</span>
</span><span id="line-10">      <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-11">  <span class="nt">&lt;/property&gt;</span>
</span><span id="line-12"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-comm-udp">Using the <span class="caps">UDP</span>&nbsp;comm</h5>

<p>The <span class="caps">UDP</span> implementation of the Comm component uses <span class="caps">UDP</span> datagrams for cache-coherence and user&nbsp;messages. </p>

<p>Other than the mentioned common ones, plus the <code>bossExecutor</code>, <code>workerExecutor</code> and <code>receiveExecutor</code>&nbsp;properties
explained in [Configuring Netty Channels](#config-comm-netty, this implementation has the following configuration&nbsp;properties:</p>

<p><code>port</code> (constructor-arg, <code>int</code>) <br />
  The <span class="caps">UDP</span> port the component will send and receive messages on. This value <strong>does not</strong> have to be the same for all&nbsp;nodes.
  (nodes know each other ports by publishing them as a configuration record in the&nbsp;cluster).</p>

<p><code>multicastGroup</code> (property, <code>java.net.InetSocketAddress</code>, required if <code>sendToServerInsteadOfMulticast</code> is <code>true</code>) <br />
  The multicast <span class="caps">IP</span> address this node will join for multicast address, and the port to use for sending and receiving&nbsp;multicast
  messages. This value <strong>must be the same</strong> in all nodes. See the example below on how to set this property’s&nbsp;value.</p>

<p><code>multicastNetworkInterface</code> (property, <code>java.net.NetworkInterface</code>, default: <code>null</code>) <br />
  The network interface to use for multicast. If set to <code>null</code> (the default), the default interface will be&nbsp;used.</p>

<p><code>receiveBufferSize</code> (property, <code>int</code>, default: determined by the socket; implementation specific) <br />
  The size of the socket receive buffer (SO_<span class="caps">RCVBUF</span>). The SO_<span class="caps">RCVBUF</span> option is used by the the network implementation as a hint to size&nbsp;the 
  underlying network I/O buffers. The SO_<span class="caps">RCVBUF</span> setting may also be used by the network implementation to determine the maximum&nbsp;size
  of the packet that can be received on this&nbsp;socket.</p>

<p><code>minimumNodesToMulticast</code> (property, <code>int</code>, default: <code>3</code>) <br />
  The minimum number of nodes in the cluster (not including servers) for this component to use multicast. If there are&nbsp;fewer
  online nodes than this value, the component will unicast messages to each&nbsp;node.</p>

<p><code>resendPeriodMillisecs</code> (property, <code>int</code>, default: <code>20</code>) <br />
  The duration in milliseconds to wait between consecutive resending of a message if a reply has not been&nbsp;received.
  If <code>exponentioalBackoff</code> is turned on (it’s turned on by default), this is the initial duration (between the first time&nbsp;the
  message is sent and the&nbsp;second).</p>

<p><code>exponentialBackoff</code> (property, <code>boolean</code>, default: <code>true</code>) <br />
  If turned on (which is the default), doubles the duration between resending of messages after each&nbsp;re-send.</p>

<p><code>jitter</code> (property, <code>boolean</code>, default: <code>false</code>) <br />
  If turned on, adds a random small jitter to the duration between&nbsp;resends.</p>

<p><code>minDelayMicrosecs</code> (property, <code>int</code>, default: <code>1</code>) <br />
  The minimum duration, in microseconds, to wait before transmitting a packet, for other messages to be sent so that they could&nbsp;be
  added to the same&nbsp;packet.</p>

<p><code>maxDelayMicrosecs</code> (property, <code>int</code>, default: <code>10</code>) <br />
  The maximum duration, in microseconds, to wait for additional messages (in case they keep arriving), before transmitting a&nbsp;packet.</p>

<p><code>maxQueueSize</code> (property, <code>int</code>, default: <code>50</code>) <br />
  The maximum number of messages waiting in the <code>comm</code> component’s message queue. If this number is reached, sending an&nbsp;additional
  message will block until the queue length falls beneath&nbsp;it.</p>

<p><code>maxPacketSize</code> (property, <code>int</code>, default: <code>4096</code>) <br />
  The maximum size of a single packet the <code>comm</code> component will transmit. Data-item size (defined by the <code>maxItemSize</code> property of the&nbsp;<code>cache</code>
  component; see <a href="#config-cache-1">Configuring the cache</a> must not exceed this value (and there must also be some room left for&nbsp;headers).</p>

<p><code>maxRequestOnlyPacketSize</code> (property, <code>int</code>, default: <code>maxPacketSize / 2</code>) <br />
  The maximum size of a packet that contains only request messages. Must be less than&nbsp;<code>maxPacketSize</code>.
  The exact semantics of this property is beyond the scope of this document, but if this value is too close to <code>maxPacketSize</code> a deadlock&nbsp;condition
  may arise (it will be clearly noted in the logs, so you can recognize it if it happens), and if it’s too small, performance under heavy load may&nbsp;suffer.</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;comm&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.netty.UDPComm&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;serverComm&quot;</span> <span class="na">ref=</span><span class="s">&quot;serverComm&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;timeout&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sendToServerInsteadOfMulticast&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span> <span class="na">value=</span><span class="s">&quot;${grid.port}&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minimumNodesToMulticast&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;multicastGroup&quot;</span><span class="nt">&gt;</span>
</span><span id="line-8">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;java.net.InetSocketAddress&quot;</span><span class="nt">&gt;</span>
</span><span id="line-9">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;225.0.0.1&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-10">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;7050&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-11">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-12">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-13">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;resendPeriodMillisecs&quot;</span> <span class="na">value=</span><span class="s">&quot;35&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-14">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;exponentialBackoff&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-15">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jitter&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-16">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;minDelayMicrosecs&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-17">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxDelayMicrosecs&quot;</span> <span class="na">value=</span><span class="s">&quot;2000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-18">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-19">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxPacketSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2048&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-20">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxRequestOnlyPacketSize&quot;</span> <span class="na">value=</span><span class="s">&quot;400&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-21">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;workerExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-22">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.ConfigurableThreadPool&quot;</span><span class="nt">&gt;</span>
</span><span id="line-23">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;corePoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-24">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maximumPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-25">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;keepAliveMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-26">            <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-27">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-28">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-29">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;receiveExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-30">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-31">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;corePoolSize&quot; --&gt;</span>
</span><span id="line-32">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxChannelMemorySize&quot; --&gt;</span>
</span><span id="line-33">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxTotalMemorySize&quot; --&gt;</span>
</span><span id="line-34">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;3&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;keepAliveTime&quot; --&gt;</span>
</span><span id="line-35">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;4&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;unit&quot; --&gt;</span>
</span><span id="line-36">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-37">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-38"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-comm-netty">Configuring Netty&nbsp;Channels</h5>

<p>Except for configuration messages used by the <code>cluster</code> component, all Galaxy network communication - peer-nodes to peer-nodes, peer-nodes to&nbsp;servers
and slaves to masters - uses the <a href="http://netty.io/">Netty</a> library (unless you’ve decided to use JGroups for peer-to-peer communication - see <a href="#config-comm-jgroups">Using the Jgroups comm</a>.</p>

<p>Netty communication channels use various&nbsp;thread-pools.
<span class="caps">TCP</span> channels use a single “boss thread” taken from a “boss” thread-pool for making or accepting connections, and possibly multiple “worker”&nbsp;threads
taken from a different pool, responsible for sending and receiving messages. <span class="caps">UDP</span> channels (they’re connectionless) only use worker&nbsp;threads. </p>

<p>Components using <span class="caps">TCP</span>, therefore have two properties, <code>bossExecutor</code> and <code>workerExecutor</code> taking an instance&nbsp;of 
<code>java.util.concurrent.ThreadPoolExecutor</code>. If you don’t set these properties, each uses a default thread-pool (returned from&nbsp;calling 
<code>java.util.concurrent.Executors.newCachedThreadPool()</code>). Components making use of <span class="caps">UDP</span> don’t have the <code>bossThread</code>&nbsp;property.</p>

<p>See <a href="#config-misc-threadpool-config">Configuring a thread-pool</a> for the thread-pool configuration&nbsp;details. </p>

<p>In addition, all components using Netty can optionally use another thread-pool, passed to the <code>receiveExecutor</code> property. This thread-pool,&nbsp;which
must be an instance of <code>org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor</code> (a subclass of&nbsp;<code>java.util.concurrent.ThreadPoolExecutor</code>),
and it is used to actually process the receive messages. If you set this property to <code>null</code> (which is the default), all message processing&nbsp;will
be done on the channel’s worker&nbsp;thread-pool.</p>

<p><code>OrderedMemoryAwareThreadPoolExecutor</code> doesn’t take a <code>maximumPoolSize</code> argument (as its core-size is also its maximum size),&nbsp;but
it does take two additional&nbsp;arguments:</p>

<p><code>maxChannelMemorySize</code> (<code>long</code>) <br />
  The maximum total size, in bytes, of the queued events per channel (i.e. per cluster node we’re communicating&nbsp;with). 
  A value of <code>0</code> disables this&nbsp;limit.</p>

<p><code>maxTotalMemorySize</code> (<code>long</code>) <br />
  The maximum total size, in bytes, of the queued events for this&nbsp;pool. 
  A value of <code>0</code> disables this&nbsp;limit.</p>

<p>Unfortunately, named constructor-args don’t seem to work with this class, so we must use argument indexes, and create the instance like&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- &quot;corePoolSize&quot; --&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- &quot;maxChannelMemorySize&quot; --&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- &quot;maxTotalMemorySize&quot; --&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;3&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- &quot;keepAliveTime&quot; --&gt;</span>
</span><span id="line-6">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;4&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- &quot;unit&quot; --&gt;</span>
</span><span id="line-7"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h5 id="config-comm-jgroups">Using the JGroups&nbsp;comm</h5>

<p>The JGroups <code>comm</code> implementation is&nbsp;<code>co.paralleluniverse.galaxy.jgroups.JGroupsComm</code>. 
It is only available when JGroups is chosen as the <code>cluster</code> component implementation (see <a href="#config-cluster-jgroups">Using JGroups</a>).
Because JGroups is configured in the <code>cluster</code> bean, this bean has no properties other than the common <code>comm</code> ones, and can be&nbsp;defined
as simply&nbsp;as:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;comm&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.jgroups.JGroupsComm&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">	<span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;serverComm&quot;</span> <span class="na">ref=</span><span class="s">&quot;serverComm&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sendToServerInsteadOfMulticast&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;timeout&quot;</span> <span class="na">value=</span><span class="s">&quot;200&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>The <code>timeout</code> and <code>sendToServerInsteadOfMulticast</code> properties are kept at their default values in this example, so they can be dropped&nbsp;entirely.</p>

<h5 id="config-comm-monitoring">Monitoring the <code>comm</code>&nbsp;component</h5>

<p><span class="caps">TBD</span></p>

<h4 id="config-server">Configuring, Running and Monitoring the&nbsp;Server</h4>

<p>The Galaxy server node (or nodes, if more than one is configured in the backup group) provides two&nbsp;features:</p>

<ul>
  <li>Disk&nbsp;persistence</li>
  <li>High availability in case of node&nbsp;failure.</li>
</ul>

<p>A Galaxy cluster does not have to be configured to have a server. If disk persistence is not required, you can rely on backup&nbsp;groups
alone for high-availability (see <a href="#api-cluster-organization-backup">Backup groups</a>). However, in some circumstances, server nodes can&nbsp;provide
other benefits, such as improved&nbsp;performance.</p>

<p>There are two kinds of servers a Galaxy cluster can use. The first, which we’ll call “real servers”, and the other we’ll call “dumb&nbsp;servers”.
We will refer to non-server nodes as “peer&nbsp;nodes”.</p>

<h5 id="config-server-real">Real&nbsp;servers</h5>

<p>Real servers are server nodes that run the Galaxy server software and (usually) access an embedded&nbsp;database.</p>

<h6 id="configuring-real-servers">Configuring real&nbsp;servers</h6>

<p>A real server has a similar configuration file to that used in peer nodes, but with some shared and some different&nbsp;components:</p>

<p><code>cluster</code> <br />
  This is the same as in the peer nodes. See <a href="#config-cluster">Configuring the Cluster Component</a> for instructions on how to configure this&nbsp;component.</p>

<p><code>comm</code> <br />
  This is the equivalent of the peer nodes’ <code>comm</code> component (see <a href="#config-comm">Configuring and Monitoring the Comm Component</a>), but it’s (currently) sole&nbsp;implementation
  (<code>co.paralleluniverse.galaxy.netty.TcpServerServerComm</code>) - the server side of the peers’ <span class="caps">TCP</span> <code>serverComm</code> - takes a&nbsp;<code>port</code> 
  property (constructor-arg, <code>int</code>), plus, optionally, the <code>bossExecutor</code>, <code>workerExecutor</code> and <code>receiveExecutor</code>&nbsp;properties
  explained in <a href="#config-comm-netty">Configuring Netty Channels</a>.</p>

<p>Here’s a configuration&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;comm&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.netty.TcpServerServerComm&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;port&quot;</span> <span class="na">value=</span><span class="s">&quot;9675&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;receiveExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-4">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.jboss.netty.handler.execution.OrderedMemoryAwareThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-5">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;corePoolSize&quot; --&gt;</span>
</span><span id="line-6">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxChannelMemorySize&quot; --&gt;</span>
</span><span id="line-7">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;maxTotalMemorySize&quot; --&gt;</span>
</span><span id="line-8">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;3&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;keepAliveTime&quot; --&gt;</span>
</span><span id="line-9">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;4&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- name=&quot;unit&quot; --&gt;</span>
</span><span id="line-10">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-11">    <span class="nt">&lt;/property&gt;</span>
</span><span id="line-12"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p><code>memory</code> <br />
  This is the equivalent of the peers’ <code>cache</code> component, and it’s responsible for the server’s data-item logic. It has one&nbsp;implementation
  (<code>co.paralleluniverse.galaxy.core.MainMemory</code>) that takes just a <code>monitoringType</code> property (see <a href="#config-monitoring">The configuration file(s)</a>).
  Here’s how it’s&nbsp;defined:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;memory&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.MainMemory&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- METRICS/JMX --&gt;</span>
</span><span id="line-3"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p><code>store</code> <br />
  This component is responsible for persisting and retrieving data items using a&nbsp;database. 
  Its configuration is explained <a href="#config-server-store">below</a>.</p>

<h6 id="running-the-server-1">Running the&nbsp;server</h6>

<p>To run the server, simply run the executable Java class <code>co.paralleluniverse.galaxy.Server</code>, and optionally pass one or two command&nbsp;line
arguments specifying the configuration file and, optionally, the properties file, too (see <a href="#config-file">The configuration file(s)</a> for an&nbsp;explanation).</p>

<p>Optionally, if for some reason you’d like to embed the Galaxy server in your own Java process, you may start the server by&nbsp;calling
<code>Server</code>’s <code>start</code> method and optionally pas the configuration and properties&nbsp;files.</p>

<p>If no configuration file is specified, the server uses the file called <code>galaxy.xml</code> if it’s found somewhere on the&nbsp;classpath.</p>

<p>You may refer to the Server class <a href="http://puniverse.github.io/galaxy/javadoc/co/paralleluniverse/galaxy/Server.html">Javadoc</a>.</p>

<h5 id="config-server-dumb">Dumb&nbsp;servers</h5>

<p>Dumb servers are machines running some sort of a database server that can be used as Galaxy servers without being Galaxy nodes&nbsp;themselves,
i.e., they do not run any Galaxy code - just the database server. Databases that provide network access can be used as dumb&nbsp;servers.
When using a dumb server, the logic for accessing and communicating with them is hosted on the peer&nbsp;nodes.</p>

<p>To configure a dumb server, you must make some changes and additions to the peers’&nbsp;components.</p>

<p><code>serverPipe</code> <br />
  This simple additional bean is responsible for piping all messages sent to the server to the local server proxy. It’s defined&nbsp;thus:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;serverPipe&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.server.CommPipe&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p><code>serverComm</code> <br />
  Instead of a <span class="caps">TCP</span> connection to a real server, we will now be directing messages to the server through the <code>serverPipe</code> so&nbsp;<code>serverComm</code>
  is now defined&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;serverComm&quot;</span> <span class="na">factory-bean=</span><span class="s">&quot;serverPipe&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;getComm1&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;${grid.nodeId}&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p><code>memory</code> <br />
  The memory component (responsible for server logic) now sits at the peers, so it has to be added to the peer configuration, and it&nbsp;receives
  messages from the other end of the&nbsp;<code>serverPipe</code>:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;memory&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.MainMemory&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;comm&quot;</span><span class="nt">&gt;</span>
</span><span id="line-3">        <span class="nt">&lt;bean</span> <span class="na">factory-bean=</span><span class="s">&quot;serverPipe&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;getComm2&quot;</span><span class="nt">&gt;</span>
</span><span id="line-4">            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-6">    <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-7">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-8"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p><code>store</code> <br />
  The store is now configured at the peers. See <a href="#config-server-store">below</a> for instructions on how to configure the&nbsp;store.</p>

<h5 id="config-server-store">Configuring the&nbsp;store</h5>

<p>The store is the component responsible for data-item persistence, and is usually implemented on top of some&nbsp;database.
At the moment there are two store implementations, one that uses <strong>Berkeley<span class="caps">DB</span> Java Edition</strong>, and that uses any <span class="caps">RDBMS</span> with a <span class="caps">JDBC</span>&nbsp;driver.</p>

<h6 id="config-server-store-bdb">Using&nbsp;Berkeley<span class="caps">DB</span></h6>

<p><a href="http://www.oracle.com/technetwork/database/berkeleydb/overview/index-093405.html">Berkeley<span class="caps">DB</span> Java Edition</a> (<span class="caps">BDB</span> <span class="caps">JE</span>) can be used as Galaxy’s store. Because <span class="caps">BDB</span> <span class="caps">JE</span> is an embedded database and does not have a network&nbsp;interface,
it can only be used as a dumb server - only as part of a real&nbsp;server. 
The <code>store</code> implementation that uses <span class="caps">BDB</span> <span class="caps">JE</span> is <code>co.paralleluniverse.galaxy.berkeleydb.BerkeleyDB</code>, and it has two configuration&nbsp;properties:</p>

<p><code>envHome</code> (constructor-arg, <code>String</code>) <br />
  The path to the directory which will contain the <span class="caps">BDB</span>&nbsp;files.</p>

<p><code>truncate</code> (property, <code>boolean</code>, default: <code>false</code>) <br />
  Whether or not the database will be truncated (i.e., all the data-item data be deleted) when the server&nbsp;starts.</p>

<p><code>durability</code> (property, <code>com.sleepycat.je.Durability.SyncPolicy</code>, default: <code>WRITE_NO_SYNC</code>) <br />
  Defines the disk synchronization policy to be used when committing a transaction. There are three possible&nbsp;values:
  <code>SYNC</code>, <code>WRITE_NO_SYNC</code>, or <code>NO_SYNC</code>, that are fully explained in the <span class="caps">BDB</span> <span class="caps">JE</span> Javadocs <a href="http://docs.oracle.com/cd/E17277_02/html/java/index.html">here</a>.</p>

<p>Tuning of Berkeley<span class="caps">DB</span> <span class="caps">JE</span> is possible by setting properties in the <code>je.properties</code> file, placed at the environment home&nbsp;directory.
Details about <span class="caps">BDB</span> <span class="caps">JE</span> tuning can be found in the <span class="caps">JE</span> documentation <a href="http://docs.oracle.com/cd/E17277_02/html/GettingStartedGuide/administration.html">here</a>. </p>

<p>Here’s a configuration&nbsp;example:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;store&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.berkeleydb.BerkeleyDB&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;envHome&quot;</span> <span class="na">value=</span><span class="s">&quot;/usr/bdb/galaxy&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;truncate&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h6 id="config-server-store-jdbc">Using&nbsp;<span class="caps">SQL</span></h6>

<p>Any <span class="caps">SQL</span> database that supports transactions and has a <span class="caps">JDBC</span> driver can be used as the store. Those that have a network interface can&nbsp;also
become dumb servers. The <code>store</code> implementation that uses <span class="caps">JDBC</span> is <code>co.paralleluniverse.galaxy.jdbc.SQLDB</code> and here are it’s&nbsp;configuration
properties:</p>

<p><code>dataSource</code> (constructor-arg, <code>javax.sql.DataSource</code>) <br />
  The <code>DataSource</code> instance used to construct <span class="caps">DB</span> connections. See the example below on how to set this&nbsp;property.</p>

<p><code>maxItemSize</code> (property, <code>int</code>, default: <code>1024</code>) <br />
  The maximum size, in bytes, of a data-item. Must be the same as the <code>maxItemSize</code> set in the <code>cache</code> component (see <a href="#config-cache-1">Configuring the cache</a>).</p>

<p><code>useUpdateableCursors</code> (property, <code>boolean</code>, default: <code>false</code>) <br />
  Whether updateable cursors should be used in some atomic transactions. Might have a positive, or negative performance impact,&nbsp;depending
  on the database and driver&nbsp;implementation.</p>

<p><code>schema</code> (property, <code>String</code>, default: <code>pugalaxy</code>) <br />
  The schema that will host the Galaxy&nbsp;table.</p>

<p><code>tableName</code> (property, <code>String</code>, default: <code>memory</code>) <br />
  The name of the table that will store the&nbsp;data-items.</p>

<p><code>bigintType</code> (property, <code>String</code>, default: queried with <code>DatabaseMetaData</code> if possible) <br />
  The name of the database’s <span class="caps">SQL</span> type for <span class="caps">JDBC</span>’s <code>BIGINT</code>. Should be set if automatic detection does not&nbsp;work.</p>

<p><code>smallintType</code> (property, <code>String</code>, default: queried with <code>DatabaseMetaData</code> if possible) <br />
  The name of the database’s <span class="caps">SQL</span> type for <span class="caps">JDBC</span>’s <code>SMALLINT</code>. Should be set if automatic detection does not&nbsp;work.</p>

<p><code>varbinaryType</code> (property, <code>String</code>, default: queried with <code>DatabaseMetaData</code> if possible) <br />
  The name of the database’s <span class="caps">SQL</span> type for <span class="caps">JDBC</span>’s <code>VARBINARY</code>. Should be set if automatic detection does not&nbsp;work.</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;store&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.jdbc.SQLDB&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span><span class="nt">&gt;</span>
</span><span id="line-3">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.apache.derby.jdbc.ClientDataSource40&quot;</span><span class="nt">&gt;</span>
</span><span id="line-4">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;serverName&quot;</span> <span class="na">value=</span><span class="s">&quot;mydbhost&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;portNumber&quot;</span> <span class="na">value=</span><span class="s">&quot;1527&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;databaseName&quot;</span> <span class="na">value=</span><span class="s">&quot;galaxydb&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;createDatabase&quot;</span> <span class="na">value=</span><span class="s">&quot;create&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-8">        <span class="nt">&lt;/bean&gt;</span>
</span><span id="line-9">    <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-10">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxItemSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-11">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;useUpdateableCursors&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-12"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>When using a <span class="caps">SQL</span> database, if the entire grid is taken down, you must manually either clear the Galaxy table (which is&nbsp;called 
<code>pugalaxy.memory</code> by default) if you’d like to dispose of the data, or, if you’d like to keep it, you must assign ownership of&nbsp;all
data items to the server by running the following <span class="caps">SQL</span>&nbsp;command:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="k">UPDATE</span> <span class="n">pugalaxy</span><span class="p">.</span><span class="n">memory</span> <span class="k">SET</span> <span class="k">owner</span><span class="o">=</span><span class="mi">0</span>
</span></code></pre></div>
<p class="alert alert-warn"><strong>Note</strong>: <strong>Do not forget</strong> to clear the database table or set the owner in all rows to <code>0</code> before re-starting the grid. If you don’t, havoc will&nbsp;ensue.</p>

<h4 id="config-misc">Miscellaneous&nbsp;Configurations</h4>

<h5 id="config-misc-threadpool">Thread&nbsp;pools</h5>

<p>Galaxy makes extensive use of&nbsp;thread-pools.</p>

<h6 id="config-misc-threadpool-config">Configuring a&nbsp;thread-pool</h6>

<p>Several Galaxy components require you to provide a thread-pool in the form of a&nbsp;<code>java.util.concurrent.ThreadPoolExecutor</code> 
instance or a subclass of&nbsp;it.</p>

<p>These are <code>ThreadPoolExecutor</code>’s&nbsp;constructor-args:</p>

<p><code>corePoolSize</code>, index:0, <code>int</code> <br />
  The number of threads to keep in the pool, even if they are&nbsp;idle.</p>

<p><code>maximumPoolSize</code>, index:1, <code>int</code> <br />
  The maximum number of threads to allow in the&nbsp;pool.</p>

<p><code>keepAliveTime</code>, index:2, <code>long</code> <br />
  When the number of threads is greater than the core, this is the maximum time that excess idle&nbsp;threads 
  will wait for new tasks before&nbsp;terminating.</p>

<p><code>unit</code>, index:3, <code>java.util.concurrent.TimeUnit</code> <br />
   The time unit for the <code>keepAliveTime</code>&nbsp;argument.
   Can be <code>NONOSECONDS</code>, <code>MICROSECONDS</code>, <code>MILLISECONDS</code>, <code>SECONDS</code>, <code>MINUTES</code>, <code>HOURS</code> or&nbsp;<code>DAYS</code>.</p>

<p><code>workQueue</code>, index:4, <code>java.util.concurrent.BlockingQueue</code> <br />
  The queue to use for holding tasks before they are&nbsp;executed. </p>

<p>For the <code>workQueue</code> argument, is is best to use&nbsp;<code>an instance of </code><code>co.paralleluniverse.common.concurrent.QueueFactory</code>`
which constructs the queue most appropriate for the given maximum size. It is defined like&nbsp;this:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.common.concurrent.QueueFactory&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;getInstance&quot;</span> <span class="na">c:maxSize=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>And there are two special values for <code>maxSize</code>. <code>-1</code> designates an unbounded queue, and <code>0</code> specifies a handoff&nbsp;“queue”
where each producer must wait for a consumer (i.e. there can be no tasks waiting in the&nbsp;queue).</p>

<p>Here’s an example of an inner bean (<a href="#config-spring-values-inner">Compound values (inner beans)</a>) defining a&nbsp;<code>ThreadPoolExecutor</code>:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;java.util.concurrent.ThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;2&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;3&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
</span><span id="line-7">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.common.concurrent.QueueFactory&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;getInstance&quot;</span> <span class="na">c:maxSize=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-8">    <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-9"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>Galaxy provides a convenience class that is a bit simpler to declare, which can be used instead of&nbsp;<code>java.util.concurrent.ThreadPoolExecutor</code>
(<strong>but not when a specific subtype is required!</strong>)</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.ConfigurableThreadPool&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;corePoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maximumPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;keepAliveMillis&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<p>Some Galaxy components may ask for a <code>co.paralleluniverse.galaxy.core.NodeOrderedThreadPoolExecutor</code>, which&nbsp;is 
configured&nbsp;so:</p>

<div class="highlight"><pre><code><span id="line-1"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.NodeOrderedThreadPoolExecutor&quot;</span><span class="nt">&gt;</span>
</span><span id="line-2">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;corePoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-3">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maximumPoolSize&quot;</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-4">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;keepAliveTime&quot;</span> <span class="na">value=</span><span class="s">&quot;5000&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-5">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;unit&quot;</span> <span class="na">value=</span><span class="s">&quot;MILLISECONDS&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-6">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxQueueSize&quot;</span> <span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-7">    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;workQueue&quot;</span><span class="nt">&gt;</span>
</span><span id="line-8">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.common.concurrent.QueueFactory&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;getInstance&quot;</span> <span class="na">c:maxSize=</span><span class="s">&quot;500&quot;</span><span class="nt">/&gt;</span>
</span><span id="line-9">    <span class="nt">&lt;/constructor-arg&gt;</span>
</span><span id="line-10"><span class="nt">&lt;/bean&gt;</span>
</span></code></pre></div>
<h6 id="config-misc-threadpool-monitor">Monitoring&nbsp;thread-pools</h6>

<p>All of Galaxy’s thread-pools expose monitoring information using MBeans. All of these MBeans are&nbsp;named 
<code>co.paralleluniverse:type=ThreadPoolExecutor,name=POOL_NAME</code>, and can be found in <strong>Visual<span class="caps">VM</span></strong> or <strong>JConsole</strong> in&nbsp;the
MBean tree under the <code>co.paralleluniverse/ThreadPoolExecutor</code>&nbsp;node.</p>


					</div>
				</div><!--main-->
			</div><!--docs-cont-->
		</div> <!--container-->
	</section><!--main-->

	<!-- <top-nav> -->
<div id="doumentation-bottom-bar">
	<div class="container">
		<div class="side-title"><h2>documentation</h2></div>
		<h3>Galaxy</h3>
		<a href="https://github.com/puniverse/galaxy" class="btn-1"><span>View on Github</span></a>
		<a href="/galaxy/javadoc/index.html" class="btn-2"><span>API</span></a>
		<a href="https://github.com/puniverse/galaxy/issues/new" class="btn-3"><span>File a bug</span></a>
		<a href="https://groups.google.com/forum/#!forum/galaxy-user" class="btn-4"><span>Discuss</span></a>
	</div>
</div>
<!-- </top-nav> -->


	<footer>
        <div class="container">
            <div id="logo-footer"></div>
            <ul>
                <li><a href="http://paralleluniverse.co/support">Support</a></li>
                <li><a href="http://docs.paralleluniverse.co">Documentation</a></li>
                <li><a href="http://paralleluniverse.co/about/">Company</a></li>
                <li><a href="http://blog.paralleluniverse.co">Blog</a></li>
            </ul>
            <a href="https://www.facebook.com/puniverseco" class="social social1">social</a>
            <a href="https://twitter.com/puniverseco" class="social social2">social</a>
            <a href="http://www.linkedin.com/company/parallel-universe?trk=company_name" class="social social3">social</a>
        </div><!--container-->
</footer>

</body>
</html>
