
<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <title>Cluster | Galaxy</title>
        <link rel="stylesheet" href="../../_static/pygments.css" type="text/css"/>
        <link rel="stylesheet" href="../../_static/pudoc.css" type="text/css"/>
        <link rel="top" title="Galaxy" href="../../index.html"/>
        <link rel="up" title="Galaxy’s API" href="api.html"/>
        <link rel="next" title="Configuring and Monitoring Galaxy" href="../config/config.html"/>
        <link rel="prev" title="Messenger" href="api-messenger.html"/>
        <style lang="text/css">
            #top-bar, #top-bar small, #top-bar a {
                text-shadow: 0px -1px 0px #EAEAEA;
            color: #000;
            }

            #top-bar {
                background-color: #444;
            background-image: -moz-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -ms-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#FAFAFA), to(#EAEAEA));
            background-image: -webkit-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -o-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: linear-gradient(top, #FAFAFA, #EAEAEA);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#FAFAFA', endColorstr = '#EAEAEA', GradientType = 0);
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
            border-bottom: 1px solid #CACACA;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.4),0 0 10px rgba(0, 0, 0, 0.1);
            }


            .hero-unit {
                background-image: url("../../_static/xxx.png") !important;
                background-repeat: no-repeat !important;
                background-position: 30px 50px;
            }

            .hero-unit div.section {
                padding-left: 200px !important;
            }
        </style>
    </head>
    <body>
        <a href="https://github.com/puniverse/galaxy">
            <img style="position: absolute; top: 0; right: 0; border: 0;"
                 src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
                 alt="Fork me on GitHub"></a>
        <div class="navbar">
            <div class="navbar-inner container-fluid" id="top-bar">
                <header class="row-fluid">
                    <h1 class="span12" id="title">
                        <a href="../../index.html">Galaxy</a>
                        <small>a high-performance in-memory data grid</small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span3" id="sidebar">
                    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../news.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About Galaxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/getting-started.html">Getting Started With Galaxy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">Introduction to Galaxy</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="api.html">Galaxy&#8217;s API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.html#getting-the-grid-instance">Getting the grid instance</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="api.html#grid-services">Grid services</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="api-store.html">Data Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="api-messenger.html">Messenger</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Cluster Management</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#cluster-organization">Cluster organization</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#server-node">Server node</a></li>
<li class="toctree-l6"><a class="reference internal" href="#backup-groups">Backup groups</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#lifecycle-events">Lifecycle events</a></li>
<li class="toctree-l5"><a class="reference internal" href="#cluster-events">Cluster events</a></li>
<li class="toctree-l5"><a class="reference internal" href="#node-information">Node information</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#nodeinfo">NodeInfo</a></li>
<li class="toctree-l6"><a class="reference internal" href="#custom-properties">Custom properties</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#the-distributed-tree">The distributed tree</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../config/config.html">Configuring and Monitoring Galaxy</a></li>
</ul>
</li>
</ul>

                    <hr/>
                    <ul>
                        <li><a href="http://puniverse.github.com/galaxy/javadoc/index.html">Javadocs</a></li>
                        <li><a href="https://github.com/puniverse/galaxy/downloads">Download</a></li>
                        <li><a href="https://groups.google.com/forum/#!forum/xxxx">Mailing List</a></li>
                        <li><a href="https://github.com/puniverse/galaxy/issues/">Issue Tracker</a></li>
                        <li><a href="http://blog.paralleluniverse.co">Blog</a></li>
                    </ul>
                </div>
                <div class="span9" id="body">
                     
  <div class="section" id="cluster">
<span id="man-api-cluster"></span><h1>Cluster<a class="headerlink" href="#cluster" title="Permalink to this headline">¶</a></h1>
<p>The <tt class="docutils literal"><span class="pre">Cluster</span></tt> interface (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html">Javadoc</a>) provides information
about cluster nodes, and emits cluster events (like nodes joining or leaving the cluster). It also allows for easy configuration
management.</p>
<p>While an application employing Galaxy does not have to use this service, it is very useful for all clustered applications. And
while the application is free to use any other software for cluster management, this service is being used internally by Galaxy,
so when this service detects a node going down - that&#8217;s when the data-store and messenger detect is as down, as well.</p>
<p>Internally, this service employs either <a class="reference external" href="http://zookeeper.apache.org/">Apache ZooKeeper</a> (through Netflix&#8217;s <a class="reference external" href="https://github.com/Netflix/curator">Curator</a> library) or <a class="reference external" href="http://www.jgroups.org/">JGroups</a>
(see <a class="reference internal" href="../config/config-cluster.html#man-config-cluster"><em>Configuring the Cluster Component</em></a> for configuring Galaxy to use either option).
You can gain access to the underlying implementation by calling the <tt class="docutils literal"><span class="pre">getUnderlyingResource</span></tt> method
(<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#getUnderlyingResource()">Javadoc</a>)
which will return the <tt class="docutils literal"><span class="pre">CuratorZookeeperClient</span></tt> used by Galaxy for cluster management (which, in turn, can be further queried for
the underlying <tt class="docutils literal"><span class="pre">ZooKeeper</span></tt> instance) or the JGroups <tt class="docutils literal"><span class="pre">JChannel</span></tt> used for cluster management.</p>
<div class="section" id="cluster-organization">
<span id="man-api-cluster-organization"></span><h2>Cluster organization<a class="headerlink" href="#cluster-organization" title="Permalink to this headline">¶</a></h2>
<p>Every Galaxy node in the cluster has a unique name (a <tt class="docutils literal"><span class="pre">String</span></tt>) which is automatically assigned to it, and an id (a <tt class="docutils literal"><span class="pre">short</span></tt>
value) which is assigned in the local configuration file (see <a class="reference internal" href="../config/config-cluster.html#man-config-cluster"><em>Configuring the Cluster Component</em></a>) and is not unique (it is shared among
all nodes in a backup group (See <a class="reference internal" href="#man-api-cluster-organization-backup"><em>Backup groups</em></a>).
Node id <tt class="docutils literal"><span class="pre">0</span></tt> designates server nodes (see <a class="reference internal" href="#man-api-cluster-organization-server"><em>Server node</em></a>).</p>
<p>In addition, every node may expose additional properties (such as IP addresses, ports or any other information) to all other nodes
in the cluster. Some properties are used internally by Galaxy, but you can add your own (see <a class="reference internal" href="#man-api-cluster-info-properties"><em>Custom properties</em></a>).</p>
<p>Each node is, at any given moment, in one of three states: <strong>offline</strong>, <strong>joined</strong> or <strong>online</strong>.</p>
<ul class="simple">
<li>An <strong>offline</strong> node is one that is not seen by the other nodes in the cluster, either because it is turned off, disconnected
from the network, or suffering from a software failure.</li>
<li>A <strong>joined</strong> node is one which is seen by all other nodes, but does not participate in the data-grid, i.e. it cannot receive
messages or data-items. All it can do is observe other nodes&#8217; state.</li>
<li>An <strong>online</strong> node is one which fully participates in the grid, either as a master or a slave
(see <a class="reference internal" href="#man-api-cluster-organization-backup"><em>Backup groups</em></a>).</li>
</ul>
<p>When your application first starts, its node is in the offline state. When you get a grid instance (by calling <tt class="docutils literal"><span class="pre">Grid.getInstance()</span></tt>)
that&#8217;s when the node will try to join the cluster, and become <strong>joined</strong>.</p>
<p>To go online call <tt class="docutils literal"><span class="pre">grid.goOnline()</span></tt>.</p>
<div class="section" id="server-node">
<span id="man-api-cluster-organization-server"></span><h3>Server node<a class="headerlink" href="#server-node" title="Permalink to this headline">¶</a></h3>
<p>A server node (or nodes) is a special Galaxy node that doesn&#8217;t run application code, but is responsible for providing Galaxy data
with disk-based persistence. All of the data in the grid is persisted to disk on the server node, and is also automatically served
by it in case of a node failure.</p>
<p>The node server always has a node id of <tt class="docutils literal"><span class="pre">0</span></tt>, and, just like with regular nodes, you can have several server nodes in a backup groups
configuration for added availability.</p>
<p>See <a class="reference internal" href="../config/config-cluster.html#man-config-cluster-common"><em>Servers and Backup Groups</em></a> and <a class="reference internal" href="../config/config-server.html#man-config-server"><em>Configuring, Running and Monitoring the Server</em></a> for more information about configuring and running server node(s).</p>
</div>
<div class="section" id="backup-groups">
<span id="man-api-cluster-organization-backup"></span><h3>Backup groups<a class="headerlink" href="#backup-groups" title="Permalink to this headline">¶</a></h3>
<p>Galaxy nodes can be configured in backup groups. All nodes assigned the same node id in their configuration file will become part
of the same backup group. At any given time, each live backup group has exactly one <strong>master</strong> node, and zero or more <strong>slave</strong>
nodes. The master node replicates all of its owned data items to its slaves so that they can take over in case it fails.</p>
<p>When the master node fails, one of its slaves will become the master and take over. However, a master node <em>can never become a slave</em>.
A slave node is notified of its new master status by an event (see <a class="reference internal" href="#man-api-cluster-lifecycle"><em>Lifecycle events</em></a>).</p>
<p>See <a class="reference internal" href="../config/config-cluster.html#man-config-cluster-common"><em>Servers and Backup Groups</em></a> for information about configuring backup groups.</p>
</div>
</div>
<div class="section" id="lifecycle-events">
<span id="man-api-cluster-lifecycle"></span><h2>Lifecycle events<a class="headerlink" href="#lifecycle-events" title="Permalink to this headline">¶</a></h2>
<p>You can listen for important lifecycle events with the <tt class="docutils literal"><span class="pre">addLifeCycleListener</span></tt> to which you pass your <tt class="docutils literal"><span class="pre">LifeCycleListener</span></tt>
(<cite>:javadoc:`Javadoc &lt;co/paralleluniverse/galaxy/cluster/LifecycleListener.html&gt;</cite>). The listener will be notified
of the following events:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">online</span></tt> - This event will get triggered when the node reaches the <strong>online</strong> state. The single boolean parameter tells
the node is a master or a slave (see <a class="reference internal" href="#man-api-cluster-organization-backup"><em>Backup groups</em></a>).</li>
<li><tt class="docutils literal"><span class="pre">offline</span></tt> - This event will get triggered when the node goes offline for some reason. Obviously, if the node goes offline
due to a power failure, this event will not be triggered.</li>
<li><tt class="docutils literal"><span class="pre">switchToMaster</span></tt> - This event will get triggered at a slave node when it becomes the master (when the previous master has gone
offline.</li>
</ul>
<p>You can also check the current state of the local node with the methods <tt class="docutils literal"><span class="pre">isOnline</span></tt> and <tt class="docutils literal"><span class="pre">isMaster</span></tt>.</p>
<p>You remove a lifecycle listener by calling <tt class="docutils literal"><span class="pre">removeLifecycleListener</span></tt>.</p>
</div>
<div class="section" id="cluster-events">
<span id="man-api-cluster-events"></span><h2>Cluster events<a class="headerlink" href="#cluster-events" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">Cluster</span></tt> service also sends notifications about occuronces in other cluster nodes.</p>
<p>If you hand a <tt class="docutils literal"><span class="pre">NodeChangeListener</span></tt> (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/NodeChangeListener.html">Javadoc</a>)
to <tt class="docutils literal"><span class="pre">addNodeChangeListener</span></tt> you&#8217;ll be notified when a new node (actually, a backup group) comes online, when it goes offline,
and when it has a master switchover.</p>
<p>A <tt class="docutils literal"><span class="pre">SlaveConfigurationListener</span></tt> (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/SlaveConfigurationListener.html">Javadoc</a>)
passed to <tt class="docutils literal"><span class="pre">addSlaveConfigurationListener</span></tt> will notify you when a slave is added to or removed from your local node&#8217;s backup group.</p>
</div>
<div class="section" id="node-information">
<span id="man-api-cluster-info"></span><h2>Node information<a class="headerlink" href="#node-information" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">Cluster</span></tt> interface has methods that return information about the local node and all other cluster nodes.</p>
<p>The <tt class="docutils literal"><span class="pre">getMyNodeId</span></tt> method returns the local node&#8217;s id, and the <tt class="docutils literal"><span class="pre">getNodes</span></tt> method returns the ids of all online nodes (actually
all online backup groups. Remember, the node id is shared by all nodes in the group).</p>
<div class="section" id="nodeinfo">
<h3>NodeInfo<a class="headerlink" href="#nodeinfo" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">NodeInfo</span></tt> interface (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/NodeInfo.html">Javadoc</a>)
let&#8217;s you access the configuration record published by any node in the cluster.</p>
<p><tt class="docutils literal"><span class="pre">getMyNodeInfo</span></tt> returns the <tt class="docutils literal"><span class="pre">NodeInfo</span></tt> of the local node, so by calling</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">grid</span><span class="o">.</span><span class="na">cluster</span><span class="o">().</span><span class="na">getMyNodeInfo</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>
</pre></div>
</div>
<p>you can get the local node&#8217;s unique name.</p>
<p>There are other methods in the <tt class="docutils literal"><span class="pre">Cluster</span></tt> interface that let you access the <tt class="docutils literal"><span class="pre">NodeInfo</span></tt> of just about any node in the cluster.
Refer to the Javadoc for more information.</p>
</div>
<div class="section" id="custom-properties">
<span id="man-api-cluster-info-properties"></span><h3>Custom properties<a class="headerlink" href="#custom-properties" title="Permalink to this headline">¶</a></h3>
<p>Other than its name and id, each node&#8217;s configuration record can hold any number of additional properties, which can be accessed
by <tt class="docutils literal"><span class="pre">NodeInfo</span></tt>&#8216;s <tt class="docutils literal"><span class="pre">get</span></tt> or <tt class="docutils literal"><span class="pre">getProperties</span></tt> methods.</p>
<p>You can add a custom node property, and additionally require that nodes that have not yet publish a value for the property will not be
in considered <strong>online</strong> until they do, with the <tt class="docutils literal"><span class="pre">addNodeProperty</span></tt> method (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addNodeProperty(java.lang.String, boolean, boolean, co.paralleluniverse.galaxy.cluster.ReaderWriter)">Javadoc</a>).
Refer to the Javadoc for more information.</p>
<p>The <tt class="docutils literal"><span class="pre">setNodeProperty</span></tt> method lets you set a property of the local node.</p>
<p>The <tt class="docutils literal"><span class="pre">addMasterNodePropertyListener</span></tt> (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addMasterNodePropertyListener(java.lang.String, co.paralleluniverse.galaxy.cluster.NodePropertyListener)">Javadoc</a>)
and <tt class="docutils literal"><span class="pre">addSlaveNodePropertyListener</span></tt> (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/Cluster.html#addSlaveNodePropertyListener(java.lang.String, co.paralleluniverse.galaxy.cluster.NodePropertyListener)">Javadoc</a>)
methods allow you to listen for changes in the values of configuration record properties of any master node in the cluster
or any of your slave nodes respectively.</p>
</div>
</div>
<div class="section" id="the-distributed-tree">
<span id="man-api-cluster-tree"></span><h2>The distributed tree<a class="headerlink" href="#the-distributed-tree" title="Permalink to this headline">¶</a></h2>
<p>Galaxy nodes publish their configuration record via a service called <tt class="docutils literal"><span class="pre">DistributedTree</span></tt> (<a class="reference external" href="http://puniverse.github.com/galaxy/javadoc/co/paralleluniverse/galaxy/cluster/DistributedTree.html">Javadoc</a>) which implements a distributed filesystem-like tree of information nodes
(very similar to the way Apache ZooKeeper works, and in fact, when the cluster is configured to use ZooKeeper, the <tt class="docutils literal"><span class="pre">DistributedTree</span></tt> is just a thin layer on top of it).
<tt class="docutils literal"><span class="pre">DistributedTree</span></tt> makes some strong consistency and ordering guarantees about it&#8217;s data, which make it suitable for sharing critical configuration data and for
coordination tasks among nodes, such as leader election. Galaxy&#8217;s <tt class="docutils literal"><span class="pre">NodeInfo</span></tt> records simply wrap the <tt class="docutils literal"><span class="pre">DistributedTree</span></tt> nodes in one of its branches (directories).</p>
<p>If you&#8217;d like direct access to the tree, you can obtain the <tt class="docutils literal"><span class="pre">DistributedTree</span></tt> instance by calling the <tt class="docutils literal"><span class="pre">getDistributedTree</span></tt> method.</p>
</div>
</div>


                </div>
            </div>
            <hr/>
            <footer>
                &copy; Copyright 2012, Parallel Universe Software Co..
                Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>
                1.1.3.
            </footer>
        </div>
    </body>
</html>


