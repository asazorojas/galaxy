
<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <title>Configuring and Monitoring the Cache | Galaxy</title>
        <link rel="stylesheet" href="../../_static/pygments.css" type="text/css"/>
        <link rel="stylesheet" href="../../_static/pudoc.css" type="text/css"/>
        <link rel="top" title="Galaxy" href="../../index.html"/>
        <link rel="up" title="Configuring and Monitoring Galaxy" href="config.html"/>
        <link rel="next" title="Configuring and Monitoring the Messenger" href="config-messenger.html"/>
        <link rel="prev" title="Configuring the Cluster Component" href="config-cluster.html"/>
        <style lang="text/css">
            #top-bar, #top-bar small, #top-bar a {
                text-shadow: 0px -1px 0px #EAEAEA;
            color: #000;
            }

            #top-bar {
                background-color: #444;
            background-image: -moz-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -ms-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#FAFAFA), to(#EAEAEA));
            background-image: -webkit-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: -o-linear-gradient(top, #FAFAFA, #EAEAEA);
            background-image: linear-gradient(top, #FAFAFA, #EAEAEA);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#FAFAFA', endColorstr = '#EAEAEA', GradientType = 0);
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
            border-bottom: 1px solid #CACACA;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.4),0 0 10px rgba(0, 0, 0, 0.1);
            }


            .hero-unit {
                background-image: url("../../_static/xxx.png") !important;
                background-repeat: no-repeat !important;
                background-position: 30px 50px;
            }

            .hero-unit div.section {
                padding-left: 200px !important;
            }
        </style>
    </head>
    <body>
        <a href="https://github.com/puniverse/galaxy">
            <img style="position: absolute; top: 0; right: 0; border: 0;"
                 src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
                 alt="Fork me on GitHub"></a>
        <div class="navbar">
            <div class="navbar-inner container-fluid" id="top-bar">
                <header class="row-fluid">
                    <h1 class="span12" id="title">
                        <a href="../../index.html">Galaxy</a>
                        <small>a high-performance in-memory data grid</small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span3" id="sidebar">
                    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../news.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About Galaxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/getting-started.html">Getting Started With Galaxy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">Introduction to Galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/api.html">Galaxy&#8217;s API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="config.html">Configuring and Monitoring Galaxy</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="config.html#the-configuration-file-s">The configuration file(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html#configuring-galaxy-monitoring">Configuring Galaxy monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html#monitoring-galaxy-s-components">Monitoring Galaxy&#8217;s components</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html#logging">Logging</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="config.html#galaxy-s-components">Galaxy&#8217;s components</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="config-spring.html">A Spring Primer</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-cluster.html">Configuring the Cluster Component</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Configuring and Monitoring the Cache</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#configuring-the-cache">Configuring the cache</a></li>
<li class="toctree-l5"><a class="reference internal" href="#configuring-local-storage">Configuring local storage</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#heap-local-storage">Heap local storage</a></li>
<li class="toctree-l6"><a class="reference internal" href="#off-heap-local-storage">Off-heap local storage</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#configuring-backup">Configuring Backup</a></li>
<li class="toctree-l5"><a class="reference internal" href="#monitoring-the-cache">Monitoring the cache</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="config-messenger.html">Configuring and Monitoring the Messenger</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-comm.html">Configuring and Monitoring the Comm Component</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-server.html">Configuring, Running and Monitoring the Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-misc.html">Miscellaneous Configurations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

                    <hr/>
                    <ul>
                        <li><a href="../../javadoc/index.html">Javadocs</a></li>
                        <li><a href="https://github.com/puniverse/galaxy/downloads">Download</a></li>
                        <li><a href="https://groups.google.com/forum/#!forum/galaxy-user">Mailing List</a></li>
                        <li><a href="https://github.com/puniverse/galaxy/issues/">Issue Tracker</a></li>
                        <li><a href="http://blog.paralleluniverse.co">Blog</a></li>
                    </ul>
                </div>
                <div class="span9" id="body">
                     
  <div class="section" id="configuring-and-monitoring-the-cache">
<span id="man-config-cache"></span><h1>Configuring and Monitoring the Cache<a class="headerlink" href="#configuring-and-monitoring-the-cache" title="Permalink to this headline">¶</a></h1>
<p>The cache (bean id <tt class="docutils literal"><span class="pre">cache</span></tt>) is the component responsible for the managements of data items in the local node&#8217;s RAM, and for
the ownership cache-coherence logic.</p>
<div class="section" id="configuring-the-cache">
<span id="man-config-cache-1"></span><h2>Configuring the cache<a class="headerlink" href="#configuring-the-cache" title="Permalink to this headline">¶</a></h2>
<p>The cache currently has only one implementation (<tt class="docutils literal"><span class="pre">co.paralleluniverse.galaxy.core.Cache</span></tt>), and the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">monitoringType</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">String</span></tt>)</dt>
<dd>Sets the monitor type to use for cache monitoring. Can be either <tt class="docutils literal"><span class="pre">METRICS</span></tt> or <tt class="docutils literal"><span class="pre">JMX</span></tt> (see <a class="reference internal" href="config.html#man-config-monitoring"><em>Configuring Galaxy monitoring</em></a>).</dd>
<dt><tt class="docutils literal"><span class="pre">synchronous</span></tt> (property, <tt class="docutils literal"><span class="pre">boolean</span></tt>, default: <tt class="docutils literal"><span class="pre">false</span></tt>)</dt>
<dd>Whether or not backups are done synchronously.
When set to <tt class="docutils literal"><span class="pre">true</span></tt>, local get operations block until the server and/or slaves have acknowledged the backup.</dd>
<dt><tt class="docutils literal"><span class="pre">maxCapacity</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">long</span></tt>)</dt>
<dd>The maximum capacity (in bytes) to be used for storing shared items. If shared items take up more space than that, they will be evicted from the cache.
Note that owned items are never evicted.</dd>
<dt><tt class="docutils literal"><span class="pre">maxItemSize</span></tt> (property, <tt class="docutils literal"><span class="pre">int</span></tt>, default: <tt class="docutils literal"><span class="pre">1024</span></tt>)</dt>
<dd>The maximum size, in bytes of a single data item. If <tt class="docutils literal"><span class="pre">UDPComm</span></tt> is used as the <tt class="docutils literal"><span class="pre">comm</span></tt> implementation (see <a class="reference internal" href="config-comm.html#man-config-comm"><em>Configuring and Monitoring the Comm Component</em></a>), then an item must fit in
a single UDP packet with room to spare. Ideally, it would fit in one IP packet, so for larger values of <tt class="docutils literal"><span class="pre">maxItemSize</span></tt> it&#8217;s best to configure your network
to use jumbo packets. This value must be the same in all nodes.</dd>
<dt><tt class="docutils literal"><span class="pre">rollbackSupported</span></tt> (property, <tt class="docutils literal"><span class="pre">boolean</span></tt>, default: <tt class="docutils literal"><span class="pre">true</span></tt>)</dt>
<dd>Sets whether or not automatic rollbacks for transactions are supported. See <a class="reference internal" href="../api/api-store.html#man-api-store-transactions"><em>Transactions</em></a> and the <tt class="docutils literal"><span class="pre">Store.rollback()</span></tt>
(<a class="reference external" href="../../javadoc/co/paralleluniverse/galaxy/Store.html#rollback(co.paralleluniverse.galaxy.StoreTransaction)">Javadoc</a>).</dd>
<dt><tt class="docutils literal"><span class="pre">compareBeforeWrite</span></tt> (property, <tt class="docutils literal"><span class="pre">boolean</span></tt>, default: <tt class="docutils literal"><span class="pre">true</span></tt>)</dt>
<dd>Sets whether or not written items should first be compared with their old value before creating a new version (Galaxy maintains a version number for each item
to track updates).</dd>
<dt><tt class="docutils literal"><span class="pre">reuseLines</span></tt> (property, <tt class="docutils literal"><span class="pre">boolean</span></tt>, default: <tt class="docutils literal"><span class="pre">true</span></tt>)</dt>
<dd>Sets whether or not the cache should pool and reuse the data-item book-keeping objects.</dd>
<dt><tt class="docutils literal"><span class="pre">reuseSharerSets</span></tt> (property, <tt class="docutils literal"><span class="pre">boolean</span></tt>, default: <tt class="docutils literal"><span class="pre">false</span></tt>)</dt>
<dd>Sets whether or not the cache should pool and reuse the objects used to store data-item sharers.</dd>
<dt><tt class="docutils literal"><span class="pre">maxStaleReadMillis</span></tt> (property, <tt class="docutils literal"><span class="pre">long</span></tt>, default: <tt class="docutils literal"><span class="pre">500</span></tt>)</dt>
<dd>The maximum amount of time (in milliseconds) allowed to elapse since an item has been invalidated while still allowing the <strong>get</strong> operation
to return the old value. Note that if a <strong>get</strong> could result in any inconsistency, the fresh value will always be retrieved from the owning
node no matter what the value of this property is.</dd>
</dl>
<p>Here&#8217;s an example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cache&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.Cache&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxCapacity&quot;</span> <span class="na">value=</span><span class="s">&quot;100000000&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxItemSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;reuseLines&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;reuseSharerSets&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rollbackSupported&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;compareBeforeWrite&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Synchronous mode is not yet implemented in this version.</p>
</div>
</div>
<div class="section" id="configuring-local-storage">
<span id="man-config-cache-storage"></span><h2>Configuring local storage<a class="headerlink" href="#configuring-local-storage" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">localStorage</span></tt> is a component related to <tt class="docutils literal"><span class="pre">cache</span></tt>. It is responsible for the actual storage in RAM of the data items.
There are currently two implementations - one keeps the items in the Java heap, and one stores them in direct <tt class="docutils literal"><span class="pre">ByteBuffer</span></tt> s.</p>
<div class="section" id="heap-local-storage">
<h3>Heap local storage<a class="headerlink" href="#heap-local-storage" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">co.paralleluniverse.galaxy.HeapLocalStorage</span></tt> implementation stores items in plain Java byte-arrays, allowing the Java garbage-collector
to reclaim them when appropriate.</p>
<p>It has one property - <tt class="docutils literal"><span class="pre">monitoringType</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">String</span></tt>), which you can set to either <tt class="docutils literal"><span class="pre">METRICS</span></tt> or <tt class="docutils literal"><span class="pre">JMX</span></tt> (see <a class="reference internal" href="config.html#man-config-monitoring"><em>Configuring Galaxy monitoring</em></a>).</p>
<p>This is how you configure it:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;localStorage&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.HeapLocalStorage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="off-heap-local-storage">
<h3>Off-heap local storage<a class="headerlink" href="#off-heap-local-storage" title="Permalink to this headline">¶</a></h3>
<p>The other <tt class="docutils literal"><span class="pre">localStorage</span></tt> implementation, <tt class="docutils literal"><span class="pre">co.paralleluniverse.galaxy.core.OffHeapLocalStorage</span></tt>, stores data items in direct <tt class="docutils literal"><span class="pre">ByteBuffer</span></tt> s and manages
allocations and de-allocations. It manages blocks of fixed-sized memory pages, each block used for data items of certain sizes. When allocating memory for
an item of sized <tt class="docutils literal"><span class="pre">n</span></tt>, the memory buffer returned will be the nearest power-of-two greater-or-equal to <tt class="docutils literal"><span class="pre">n</span></tt>.</p>
<p>It has several configuration properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">monitoringType</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">String</span></tt>)</dt>
<dd>Can be <tt class="docutils literal"><span class="pre">METRICS</span></tt> or <tt class="docutils literal"><span class="pre">JMX</span></tt> (see <a class="reference internal" href="config.html#man-config-monitoring"><em>Configuring Galaxy monitoring</em></a>).</dd>
<dt><tt class="docutils literal"><span class="pre">pageSize</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">int</span></tt>)</dt>
<dd>The size <strong>in kilobytes</strong> of each memory page used by the allocator.</dd>
<dt><tt class="docutils literal"><span class="pre">maxItemSize</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">int</span></tt>)</dt>
<dd>The maximum size, in bytes of a single data item. Must be set to the same value as the <tt class="docutils literal"><span class="pre">maxItemSize</span></tt> property of the <tt class="docutils literal"><span class="pre">cache</span></tt> component.</dd>
<dt><tt class="docutils literal"><span class="pre">maxPagesForConcurrency</span></tt> (property, <tt class="docutils literal"><span class="pre">int</span></tt>, default: <tt class="docutils literal"><span class="pre">Runtime.getRuntime().availableProcessors()</span> <span class="pre">*</span> <span class="pre">2</span></tt>)</dt>
<dd>The maximum number of pages to allocate in each block simply for reducing contention (and not because memory is exhausted).</dd>
</dl>
<p>Here&#8217;s an example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;localStorage&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.OffHeapLocalStorage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;pageSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;maxItemSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxPagesForConcurrency&quot;</span> <span class="na">value=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>The amount of memory available for direct buffer is determined by the <tt class="docutils literal"><span class="pre">XX:MaxDirectMemorySize</span></tt> command line option passed to the JVM
(the <tt class="docutils literal"><span class="pre">java</span></tt> command). For example, to provide 512MB to direct ByteBuffers, you add the following command line option to the <tt class="docutils literal"><span class="pre">java</span></tt> command:</p>
<div class="highlight-sh"><div class="highlight"><pre>-XX:MaxDirectMemorySize<span class="o">=</span>100M
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-backup">
<span id="man-config-cache-backup"></span><h2>Configuring Backup<a class="headerlink" href="#configuring-backup" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">backup</span></tt> component is responsible for backing up the node&#8217;s owned items after modifications to the server and/or slaves.
There is currently one implementation of <tt class="docutils literal"><span class="pre">backup</span></tt> - <tt class="docutils literal"><span class="pre">co.paralleluniverse.galaxy.core.BackupImpl&quot;</span></tt> - and it has two configuration properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">monitoringType</span></tt> (constructor-arg, <tt class="docutils literal"><span class="pre">String</span></tt>)</dt>
<dd>Sets the monitor type to use for cache monitoring. Can be either <tt class="docutils literal"><span class="pre">METRICS</span></tt> or <tt class="docutils literal"><span class="pre">JMX</span></tt> (see <a class="reference internal" href="config.html#man-config-monitoring"><em>Configuring Galaxy monitoring</em></a>).</dd>
<dt><tt class="docutils literal"><span class="pre">maxDelay</span></tt> (property, <tt class="docutils literal"><span class="pre">int</span></tt>, default: <tt class="docutils literal"><span class="pre">10</span></tt>)</dt>
<dd>The maximum duration, <em>in milliseconds</em>, between flushes of backup data (to the server and/or slaves.) It is also roughly the maximum amount of time
that can be &#8220;lost&#8221;, i.e. updates that can disappear if the node goes down. If it&#8217;s small, less updates can be lost in a case of failure, but both
latency and throughput would suffer.</dd>
<dt><tt class="docutils literal"><span class="pre">serverComm`</span> <span class="pre">(constructor-arg,</span> <span class="pre">``co.paralleluniverse.galaxy.core.ServerComm</span></tt>, default: autowired)</dt>
<dd>If you configure your cluster without a server, set this constructor-arg to <tt class="docutils literal"><span class="pre">null``(see</span> <span class="pre">:ref:`man-config-spring-values-null`).</span> <span class="pre">Otherwise,</span>
<span class="pre">don't</span> <span class="pre">set</span> <span class="pre">it</span> <span class="pre">at</span> <span class="pre">all,</span> <span class="pre">and</span> <span class="pre">Spring</span> <span class="pre">will</span> <span class="pre">auto-wire</span> <span class="pre">it</span> <span class="pre">to</span> <span class="pre">whatever</span> <span class="pre">``serverComm</span></tt> component you have defined (see <a class="reference internal" href="config-comm.html#man-config-comm-common-servercomm"><em>The ServerComm</em></a>).</dd>
</dl>
<p>Here&#8217;s a configuration example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;backup&quot;</span> <span class="na">class=</span><span class="s">&quot;co.paralleluniverse.galaxy.core.BackupImpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">&quot;monitoringType&quot;</span> <span class="na">value=</span><span class="s">&quot;METRICS&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxDelay&quot;</span> <span class="na">value=</span><span class="s">&quot;200&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="monitoring-the-cache">
<span id="man-config-cache-monitoring"></span><h2>Monitoring the cache<a class="headerlink" href="#monitoring-the-cache" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
</div>


                </div>
            </div>
            <hr/>
            <footer>
                &copy; Copyright 2012, Parallel Universe Software Co..
                Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>
                1.1.3.
            </footer>
        </div>
    </body>
</html>


